<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carlos Gila Blanco, Enrique Sayas Bailach">

<title>Detección de las Fases del Sueño mediante XGBoost. – Enrique Sayas Bailach</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Enrique Sayas Bailach</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ensabai"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/enrique-sayas-bailach"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Detección de las Fases del Sueño mediante XGBoost.</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Salud</div>
                <div class="quarto-category">ciencia de datos</div>
                <div class="quarto-category">XGBoost</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor/a</div>
      <div class="quarto-title-meta-contents">
               <p>Carlos Gila Blanco, Enrique Sayas Bailach </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Fecha de publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">23 de enero de 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenido</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción">0. Introducción</a></li>
  <li><a href="#librerías" id="toc-librerías" class="nav-link" data-scroll-target="#librerías">1. Librerías</a></li>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link" data-scroll-target="#objetivos">2. Objetivos</a></li>
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos">3. Datos</a>
  <ul class="collapse">
  <li><a href="#información-sobre-la-base-de-datos" id="toc-información-sobre-la-base-de-datos" class="nav-link" data-scroll-target="#información-sobre-la-base-de-datos">3.1 Información sobre la base de datos</a></li>
  <li><a href="#carga-de-los-datos" id="toc-carga-de-los-datos" class="nav-link" data-scroll-target="#carga-de-los-datos">3.2 Carga de los datos</a>
  <ul class="collapse">
  <li><a href="#etiquetas-de-fases-del-sueño" id="toc-etiquetas-de-fases-del-sueño" class="nav-link" data-scroll-target="#etiquetas-de-fases-del-sueño">3.2.1 Etiquetas de Fases del Sueño</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#extracción-de-características" id="toc-extracción-de-características" class="nav-link" data-scroll-target="#extracción-de-características">4. Extracción de características</a>
  <ul class="collapse">
  <li><a href="#biblioteca-yasa" id="toc-biblioteca-yasa" class="nav-link" data-scroll-target="#biblioteca-yasa">4.1 Biblioteca <code>yasa</code></a></li>
  <li><a href="#características-extraídas" id="toc-características-extraídas" class="nav-link" data-scroll-target="#características-extraídas">4.2 Características extraídas</a></li>
  <li><a href="#extracción-de-características-1" id="toc-extracción-de-características-1" class="nav-link" data-scroll-target="#extracción-de-características-1">4.3 Extracción de características</a>
  <ul class="collapse">
  <li><a href="#análisis-exploratorio" id="toc-análisis-exploratorio" class="nav-link" data-scroll-target="#análisis-exploratorio">4.3.1 Análisis Exploratorio</a></li>
  <li><a href="#visualización" id="toc-visualización" class="nav-link" data-scroll-target="#visualización">4.3.2 Visualización</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#modelado" id="toc-modelado" class="nav-link" data-scroll-target="#modelado">5. Modelado</a>
  <ul class="collapse">
  <li><a href="#algoritmo-xgboost-para-clasificación-de-etapas-del-sueño" id="toc-algoritmo-xgboost-para-clasificación-de-etapas-del-sueño" class="nav-link" data-scroll-target="#algoritmo-xgboost-para-clasificación-de-etapas-del-sueño">5.1 Algoritmo <code>XGBoost</code> para Clasificación de Etapas del Sueño</a>
  <ul class="collapse">
  <li><a href="#interpretabilidad" id="toc-interpretabilidad" class="nav-link" data-scroll-target="#interpretabilidad">5.1.1 Interpretabilidad</a></li>
  </ul></li>
  <li><a href="#modelo-wake" id="toc-modelo-wake" class="nav-link" data-scroll-target="#modelo-wake">5.2 Modelo Wake</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo" id="toc-creación-del-modelo" class="nav-link" data-scroll-target="#creación-del-modelo">5.2.1 Creación del modelo</a></li>
  <li><a href="#selección-de-características" id="toc-selección-de-características" class="nav-link" data-scroll-target="#selección-de-características">5.2.2 Selección de características</a></li>
  <li><a href="#uso-de-surrogate-model-para-la-interpretabilidad" id="toc-uso-de-surrogate-model-para-la-interpretabilidad" class="nav-link" data-scroll-target="#uso-de-surrogate-model-para-la-interpretabilidad">5.2.3 Uso de <code>Surrogate model</code> para la interpretabilidad</a></li>
  <li><a href="#métricas" id="toc-métricas" class="nav-link" data-scroll-target="#métricas">5.2.4 Métricas</a></li>
  </ul></li>
  <li><a href="#modelo-n1" id="toc-modelo-n1" class="nav-link" data-scroll-target="#modelo-n1">5.3 Modelo N1</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo-1" id="toc-creación-del-modelo-1" class="nav-link" data-scroll-target="#creación-del-modelo-1">5.3.1 Creación del modelo</a></li>
  <li><a href="#selección-de-características-1" id="toc-selección-de-características-1" class="nav-link" data-scroll-target="#selección-de-características-1">5.3.2 Selección de características</a></li>
  <li><a href="#uso-de-surrogate-model-para-la-interpretabilidad-1" id="toc-uso-de-surrogate-model-para-la-interpretabilidad-1" class="nav-link" data-scroll-target="#uso-de-surrogate-model-para-la-interpretabilidad-1">5.3.3 Uso de <code>Surrogate model</code> para la interpretabilidad</a></li>
  <li><a href="#métricas-1" id="toc-métricas-1" class="nav-link" data-scroll-target="#métricas-1">5.3.4 Métricas</a></li>
  </ul></li>
  <li><a href="#modelo-n2" id="toc-modelo-n2" class="nav-link" data-scroll-target="#modelo-n2">5.4 Modelo N2</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo-2" id="toc-creación-del-modelo-2" class="nav-link" data-scroll-target="#creación-del-modelo-2">5.4.1 Creación del modelo</a></li>
  <li><a href="#selección-de-características-2" id="toc-selección-de-características-2" class="nav-link" data-scroll-target="#selección-de-características-2">5.4.2 Selección de características</a></li>
  <li><a href="#uso-de-surrogate-model-para-la-interpretabilidad-2" id="toc-uso-de-surrogate-model-para-la-interpretabilidad-2" class="nav-link" data-scroll-target="#uso-de-surrogate-model-para-la-interpretabilidad-2">5.4.3 Uso de <code>Surrogate model</code> para la interpretabilidad</a></li>
  <li><a href="#métricas-2" id="toc-métricas-2" class="nav-link" data-scroll-target="#métricas-2">5.4.4 Métricas</a></li>
  </ul></li>
  <li><a href="#modelo-n3" id="toc-modelo-n3" class="nav-link" data-scroll-target="#modelo-n3">5.5 Modelo N3</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo-3" id="toc-creación-del-modelo-3" class="nav-link" data-scroll-target="#creación-del-modelo-3">5.5.1 Creación del modelo</a></li>
  <li><a href="#selección-de-características-3" id="toc-selección-de-características-3" class="nav-link" data-scroll-target="#selección-de-características-3">5.5.2 Selección de características</a></li>
  <li><a href="#uso-de-surrogate-model-para-la-interpretabilidad-3" id="toc-uso-de-surrogate-model-para-la-interpretabilidad-3" class="nav-link" data-scroll-target="#uso-de-surrogate-model-para-la-interpretabilidad-3">5.5.3 Uso de <code>Surrogate model</code> para la interpretabilidad</a></li>
  <li><a href="#métricas-3" id="toc-métricas-3" class="nav-link" data-scroll-target="#métricas-3">5.5.4 Métricas</a></li>
  </ul></li>
  <li><a href="#modelo-rem" id="toc-modelo-rem" class="nav-link" data-scroll-target="#modelo-rem">5.6 Modelo REM</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo-4" id="toc-creación-del-modelo-4" class="nav-link" data-scroll-target="#creación-del-modelo-4">5.6.1 Creación del modelo</a></li>
  <li><a href="#selección-de-características-4" id="toc-selección-de-características-4" class="nav-link" data-scroll-target="#selección-de-características-4">5.6.2 Selección de características</a></li>
  <li><a href="#uso-de-surrogate-model-para-la-interpretabilidad-4" id="toc-uso-de-surrogate-model-para-la-interpretabilidad-4" class="nav-link" data-scroll-target="#uso-de-surrogate-model-para-la-interpretabilidad-4">5.6.3 Uso de <code>Surrogate model</code> para la interpretabilidad</a></li>
  <li><a href="#métricas-4" id="toc-métricas-4" class="nav-link" data-scroll-target="#métricas-4">5.6.4 Métricas</a></li>
  </ul></li>
  <li><a href="#modelo-global" id="toc-modelo-global" class="nav-link" data-scroll-target="#modelo-global">5.7 Modelo Global</a>
  <ul class="collapse">
  <li><a href="#creación-del-modelo-5" id="toc-creación-del-modelo-5" class="nav-link" data-scroll-target="#creación-del-modelo-5">5.7.1 Creación del modelo</a></li>
  <li><a href="#métricas-5" id="toc-métricas-5" class="nav-link" data-scroll-target="#métricas-5">5.7.2 Métricas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#uso-del-conjunto-de-test" id="toc-uso-del-conjunto-de-test" class="nav-link" data-scroll-target="#uso-del-conjunto-de-test">6. Uso del conjunto de test</a></li>
  <li><a href="#comparación-con-el-artículo-de-referencia" id="toc-comparación-con-el-artículo-de-referencia" class="nav-link" data-scroll-target="#comparación-con-el-artículo-de-referencia">7. Comparación con el artículo de referencia</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introducción" class="level1">
<h1>0. Introducción</h1>
<p>El sueño es un proceso biológico compuesto por una serie de fases que permiten la restauración física y mental del cuerpo. Estas fases, que incluyen el sueño ligero (N1 y N2), el sueño profundo (N3) y el sueño REM. La comprensión de estas etapas resulta esencial en el ámbito de la analítica de datos en salud, particularmente en el diagnóstico y tratamiento de trastornos del sueño.</p>
<p>En este trabajo se aborda el análisis de datos polisomnográficos (PSG) utilizando el conjunto de datos ISRUC-Sleep, que contiene en su tercer subgrupo las fases del sueño recogidas en 10 pacientes. En el proyecto se aplicarán distintos modelos XGBoost para automatizar la detección de las distintas fases del sueño a través de la extracción de características de los archivos .edf.</p>
</section>
<section id="librerías" class="level1">
<h1>1. Librerías</h1>
<div id="5e12c918" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mne</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yasa</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> label_binarize</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc, classification_report</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier, plot_tree</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ydata_profiling <span class="im">import</span> ProfileReport</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <div>
                <ins><a href="https://ydata.ai/register">Upgrade to ydata-sdk</a></ins>
                <p>
                    Improve your data and profiling with ydata-sdk, featuring data quality scoring, redundancy detection, outlier identification, text validation, and synthetic data generation.
                </p>
            </div>
            
</div>
</div>
</section>
<section id="objetivos" class="level1">
<h1>2. Objetivos</h1>
<p>El principal objetivo de este trabajo es desarrollar modelos XGBoost que permitan detectar las fases del sueño automáticamente. Para ello, se realizará lo siguiente:</p>
<ul>
<li>Realizar la importación de los datos, así como un análisis exploratorio de los mismos.</li>
<li>Realizar la extracción de características por medio de la librería YASA.</li>
<li>Crear un modelo XGBoost especializado para cada una de las 5 fases, así como un modelo surrogate para facilitar la interpretación.</li>
<li>Obtener los resultados en test y compararlos con los resultados del artículo de referencia.</li>
<li>Crear un dashboard que permita al médico el fácil manejo del modelo, con gráficos e información que le permitan interactuar y lograr una interpretación más sencilla.</li>
</ul>
</section>
<section id="datos" class="level1">
<h1>3. Datos</h1>
<section id="información-sobre-la-base-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="información-sobre-la-base-de-datos">3.1 Información sobre la base de datos</h2>
<p>Lee: <a href="http://dataset.isr.uc.pt/ISRUC_Sleep/Content.pdf">http://dataset.isr.uc.pt/ISRUC_Sleep/Content.pdf</a></p>
<p>Cada archivo comprimido contiene:<br>
- Un archivo <code>.rec</code>, que en realidad es un archivo <code>.edf</code> (RENÓMBRALO de <code>.rec</code> a <code>.edf</code>).<br>
- Dos archivos <code>.txt</code> que son las anotaciones de los especialistas.<br>
- Dos archivos <code>.xlsx</code> que contienen la misma información (Etapa) y más datos (muy útiles si deseas entender por qué se cometen errores, descartar épocas de calidad cuestionable, etc.).</p>
<p>El PSG está compuesto por señales de los siguientes canales:</p>
<ul>
<li>EEG (F3, C3, O1, F4, C4 y O2)<br>
</li>
<li>Electrooculograma (EOG), derecho e izquierdo (ROC y LOC)<br>
</li>
<li>Electrocardiograma (ECG)<br>
</li>
<li>Tipos de EMG: un m. submentalis (EMG del mentón, X1) y dos m. tibialis (EMGs de las piernas)<br>
</li>
<li>Las referencias se colocaron en los lóbulos de las orejas izquierda y derecha (A1, A2).</li>
</ul>
</section>
<section id="carga-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-los-datos">3.2 Carga de los datos</h2>
<div id="772b7f31" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_raw(test<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    raw_list <span class="op">=</span> []</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> test:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        n1 <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        n2 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        n1 <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        n2 <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(n1,n2<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="st">"data/"</span> <span class="op">+</span> <span class="bu">str</span>(n) <span class="op">+</span> <span class="st">"/"</span> <span class="op">+</span> <span class="bu">str</span>(n) <span class="op">+</span> <span class="st">".edf"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        raw <span class="op">=</span> mne.io.read_raw_edf(path, preload<span class="op">=</span><span class="va">True</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Change the freq. to 100 Hz to reduce compute time (we don't have any frequencies of interest above 50Hz)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        raw.resample(<span class="dv">100</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter to remove base line (very low freqs. produced by breathing, leg movement, etc.) </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        raw.<span class="bu">filter</span>(<span class="fl">0.3</span>, <span class="dv">49</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append to the list</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        raw_list.append(raw)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> raw_list</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> observe_data(raw_list: <span class="bu">list</span>):</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="bu">len</span>(raw_list), <span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">False</span>, figsize <span class="op">=</span> (<span class="bu">len</span>(raw_list),<span class="bu">len</span>(raw_list)<span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    cont <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ax, raw) <span class="kw">in</span> <span class="bu">zip</span>(axes, raw_list):</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Observe the data</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        sf <span class="op">=</span> raw.info[<span class="st">'sfreq'</span>]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        chan <span class="op">=</span> raw.ch_names</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Warning: change the scale of the data if we access it directly!</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> raw.get_data() <span class="op">*</span> <span class="fl">1e6</span> <span class="co">#m icroVolts (mne works in V)</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data[:,:<span class="op">-</span><span class="bu">int</span>(<span class="dv">30</span><span class="op">*</span>sf)] <span class="co"># Delete te last 30s because the reference article does so</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the signal</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        times <span class="op">=</span> np.arange(data.shape[<span class="op">-</span><span class="dv">1</span>]) <span class="op">/</span> sf</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        time_range<span class="op">=</span> <span class="bu">slice</span>(<span class="bu">int</span>(<span class="dv">50</span><span class="op">*</span>sf), <span class="bu">int</span>(<span class="dv">100</span><span class="op">*</span>sf)) <span class="co"># Choose some seconds range to plot</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        ax.plot(times[time_range], data[<span class="dv">0</span>, time_range], lw<span class="op">=</span><span class="fl">1.5</span>, color<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Patient '</span> <span class="op">+</span> <span class="bu">str</span>(cont))</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        cont <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">"Datos del sueño EEG"</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">"Tiempo (segundos)"</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">"Amplitud (V)"</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación se cargan los primeros 8 pacientes, los cuales serán utilizados para el conjunto de entrenamiento y validación.</p>
<div id="89bd6af2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>raw_train_list <span class="op">=</span> load_raw()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="etiquetas-de-fases-del-sueño" class="level3">
<h3 class="anchored" data-anchor-id="etiquetas-de-fases-del-sueño">3.2.1 Etiquetas de Fases del Sueño</h3>
<p>A continuación, se detalla la codificación de las fases en los archivos del conjunto de datos ISRUC-SLEEP.</p>
<p>Ten cuidado, ya que no existe el valor 4 (anteriormente se distinguía una fase adicional).</p>
<ul>
<li>0 -&gt; W (Vigilia)<br>
</li>
<li>1 -&gt; N1<br>
</li>
<li>2 -&gt; N2<br>
</li>
<li>3 -&gt; N3<br>
</li>
<li>5 -&gt; REM</li>
</ul>
<p>El formato predeterminado del hipnograma en YASA es un vector entero unidimensional donde:</p>
<ul>
<li>-2 = Sin puntuación<br>
</li>
<li>-1 = Artefacto / Movimiento<br>
</li>
<li>0 = Vigilia (Wake)<br>
</li>
<li>1 = Sueño N1<br>
</li>
<li>2 = Sueño N2<br>
</li>
<li>3 = Sueño N3<br>
</li>
<li>4 = Sueño REM</li>
</ul>
<div id="99f5b562" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_labels(test<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    labels_list <span class="op">=</span> []</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> test:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        n1 <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        n2 <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        n1 <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        n2 <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(n1,n2<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> <span class="st">"data/"</span> <span class="op">+</span> <span class="bu">str</span>(n) <span class="op">+</span> <span class="st">"/"</span> <span class="op">+</span> <span class="bu">str</span>(n) <span class="op">+</span> <span class="st">"_1.txt"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> pd.read_csv(path, header<span class="op">=</span><span class="va">None</span>).squeeze(<span class="st">"columns"</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        labels[labels <span class="op">==</span> <span class="dv">5</span>] <span class="op">=</span> <span class="dv">4</span>  <span class="co"># Recode REM from 5 to 4 for YASA compatibility</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> labels[:<span class="op">-</span><span class="dv">30</span>]  <span class="co"># Remove last 30 epochs (each epoch is 30s)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append to the list</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        labels_list.append(labels)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> labels_list</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> observe_labels(labels_list):</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a mapping for sleep stages</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    sleep_stages <span class="op">=</span> {</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>: <span class="st">'Wake'</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">'N1 sleep'</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">'N2 sleep'</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="st">'N3 sleep'</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">'REM sleep'</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="bu">int</span>(<span class="bu">len</span>(labels_list) <span class="op">/</span> <span class="dv">2</span>), <span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">False</span>, figsize <span class="op">=</span> (<span class="bu">len</span>(labels_list)<span class="op">+</span><span class="dv">5</span>,<span class="bu">len</span>(labels_list)))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    contx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    conty <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    cont <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> labels <span class="kw">in</span> labels_list:</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate accumulated time in each phase (in minutes)</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        accumulated_time <span class="op">=</span> labels.value_counts() <span class="op">*</span> <span class="fl">0.5</span>  <span class="co"># Each sample is 30 seconds, so multiply by 0.5 to get minutes</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the distribution of sleep stages</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        sns.barplot(x <span class="op">=</span> accumulated_time.index.<span class="bu">map</span>(sleep_stages), y<span class="op">=</span>accumulated_time.values, order<span class="op">=</span>sleep_stages.values(), ax<span class="op">=</span>axes[conty,contx])</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_ylabel(<span class="st">""</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_xlabel(<span class="st">""</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_title(<span class="st">'Paciente '</span> <span class="op">+</span> <span class="bu">str</span>(cont))</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        conty <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        cont <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conty <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            conty <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>            contx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">"Tiempo Acumulado por Etapa del Sueño"</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">"Estados del Sueño"</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">"Tiempo (minutos)"</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> observe_hypnogram(labels_list):</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="bu">int</span>(<span class="bu">len</span>(labels_list) <span class="op">/</span> <span class="dv">2</span>), <span class="dv">2</span>, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">False</span>, figsize <span class="op">=</span> (<span class="bu">len</span>(labels_list)<span class="op">+</span><span class="dv">5</span>,<span class="bu">len</span>(labels_list)))</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    contx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    conty <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    cont <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> labels <span class="kw">in</span> labels_list:</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>        yasa.plot_hypnogram(labels, ax<span class="op">=</span>axes[conty,contx])</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_ylabel(<span class="st">""</span>)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_xlabel(<span class="st">""</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        axes[conty, contx].set_title(<span class="st">'Paciente '</span> <span class="op">+</span> <span class="bu">str</span>(cont))</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        conty <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>        cont <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conty <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>            conty <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>            contx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">"Hipnograma"</span>)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">"Tiempo (horas)"</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">"Estado"</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>labels_train_list <span class="op">=</span> load_labels()</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>observe_labels(labels_train_list)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.png" width="1117" height="764" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b5621ba" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>observe_hypnogram(labels_train_list)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-2.png" width="1117" height="764" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="extracción-de-características" class="level1">
<h1>4. Extracción de características</h1>
<p>Utilizaremos la biblioteca <code>yasa</code> para generar características cada 30 segundos de polisomnografía, que usaremos para la clasificación de etapas del sueño.</p>
<section id="biblioteca-yasa" class="level2">
<h2 class="anchored" data-anchor-id="biblioteca-yasa">4.1 Biblioteca <code>yasa</code></h2>
<p>YASA (Yet Another Spindle Algorithm) es una herramienta en Python diseñada para analizar datos de polisomnografía (PSG) y clasificar etapas del sueño.</p>
<p>Principales funcionalidades:</p>
<li>
Clasificación de etapas del sueño: Automáticamente identifica N1, N2, N3 y REM.
</li>
<li>
Detección de eventos: Husos, ondas lentas y movimientos oculares rápidos.
</li>
<li>
Rechazo de artefactos: Limpia señales EEG para mejorar la calidad del análisis.
</li>
<li>
Análisis espectral: Potencia por bandas, pendiente <span class="math inline">\(1/f\)</span>, acoplamiento fase-amplitud, etc.
</li>
<li>
Hipnogramas: Genera gráficos y estadísticas sobre las etapas del sueño.
</li>
<p>Se trata de una buena herramienta, práctica y enfocada en la investigación del sueño.</p>
<p>Cabe destacar que YASA elimina los picos de sueño, por eso no es necesario utilizar los datos normalizados y en su lugar se hace uso de los originales.</p>
</section>
<section id="características-extraídas" class="level2">
<h2 class="anchored" data-anchor-id="características-extraídas">4.2 Características extraídas</h2>
<p>Para cada época de 30 segundos y cada canal, se calculan las siguientes características:</p>
<ol type="1">
<li>abspow (Potencia absoluta)</li>
</ol>
Es la energía total de la señal en un rango de frecuencias específico (por ejemplo, delta, theta, alfa, beta, etc.).
<li>
En EEG: Refleja la amplitud promedio de las oscilaciones cerebrales en un rango determinado y se mide en microvoltios al cuadrado.
</li>
<li>
En EMG: Un aumento indica mayor actividad muscular (movimientos o contracciones).
</li>
<li>
En EOG: Un aumento puede indicar movimientos oculares intensos (parpadeos o REM).
</li>
<ol start="2" type="1">
<li>alpha (Potencia en el rango alfa)</li>
</ol>
<li>
En EEG: Mide la potencia de la señal EEG en el rango alfa (8-13 Hz), comúnmente asociada con estados de relajación y calma, especialmente durante la transición al sueño o relajación con los ojos cerrados.
</li>
<li>
En EMG: El rango alfa no tiene una correlación directa con relajación (como en EEG). Sin embargo, puede reflejar actividad muscular en frecuencias bajas, especialmente durante movimientos lentos o tensiones isométricas.
</li>
<li>
En EOG: El rango alfa puede reflejar actividad asociada con movimientos lentos del ojo durante la transición al sueño.
</li>
<ol start="3" type="1">
<li>at (Relación alfa-theta)</li>
</ol>
Cociente entre la potencia de las ondas alfa y theta.
<li>
En EEG: Este índice puede usarse para determinar el grado de relajación o alerta.
</li>
<li>
En EMG: Se puede usar para comparar actividad de baja frecuencia entre músculos en reposo versus en movimiento.
</li>
<li>
En EOG: Indica la relación entre movimientos oculares lentos y más rápidos. Puede usarse para diferenciar estados de sueño (por ejemplo, transición al REM).
</li>
<ol start="4" type="1">
<li>beta (Potencia en el rango beta)</li>
</ol>
Representa la potencia en el rango beta (13-30 Hz).
<li>
En EEG: Estas ondas están asociadas con actividad mental, concentración y, en algunos casos, estrés o ansiedad.
</li>
<li>
En EMG: Representa actividad muscular en frecuencias más altas, asociada con movimientos musculares rápidos o contracciones voluntarias.
</li>
<li>
En EOG: Potencia en frecuencias más altas, asociada con movimientos oculares rápidos o actividad relacionada con parpadeos.
</li>
<ol start="5" type="1">
<li>db (Relación delta-beta)</li>
</ol>
Cociente entre las potencias en el rango delta (0.5-4 Hz) y beta (13-30 Hz).
<li>
En EEG: Un aumento en la relación puede indicar somnolencia o disminución de la actividad cortical.
</li>
<li>
En EMG: Una mayor relación delta-beta podría sugerir períodos de descanso muscular, ya que las frecuencias más bajas (delta) dominan en músculos relajados.
</li>
<li>
En EOG: Mayor relación indica predominancia de movimientos lentos del ojo, como en etapas tempranas del sueño.
</li>
<ol start="6" type="1">
<li>ds (Pendiente espectral delta)</li>
</ol>
<li>
En EEG: Analiza la pendiente de la potencia en el rango delta en el dominio de frecuencias, lo que puede reflejar cambios en la profundidad del sueño.
</li>
<li>
En EMG: Analiza cómo decae la potencia en el rango delta de la señal muscular. Una pendiente más pronunciada puede indicar menor actividad muscular de baja frecuencia.
</li>
<li>
En EOG: Evalúa la pendiente en el rango delta, reflejando la intensidad de movimientos lentos del ojo.
</li>
<ol start="7" type="1">
<li>dt (Relación delta-theta)</li>
</ol>
Cociente entre las potencias en los rangos delta (0.5-4 Hz) y theta (4-8 Hz).
<li>
En EEG: Se utiliza para estudiar la arquitectura del sueño, ya que estas frecuencias predominan en las etapas profundas y ligeras del sueño, respectivamente.
</li>
<li>
En EMG: Relación entre las frecuencias bajas en reposo y actividad muscular ligera. Es útil para monitorear relajación versus activación.
</li>
<li>
En EOG: Cociente entre movimientos oculares lentos y más rápidos, útil para analizar transiciones entre sueño ligero y REM.
</li>
<ol start="8" type="1">
<li>fdelta (Frecuencia dominante en delta)</li>
</ol>
Representa la frecuencia dentro del rango delta con mayor potencia.
<li>
En EEG: Es un marcador de sueño profundo (NREM etapa 3).
</li>
<li>
En EMG: Indica la frecuencia más representativa en el rango delta de la señal muscular. Un valor alto puede reflejar vibraciones musculares lentas.
</li>
<li>
En EOG: Frecuencia más representativa en movimientos lentos del ojo. Una frecuencia alta puede reflejar parpadeos frecuentes.
</li>
<ol start="9" type="1">
<li>hcomp (Complejidad de Higuchi)</li>
</ol>
Estima la complejidad de la señal EEG utilizando el algoritmo de Higuchi.
<li>
En EEG: Es útil para analizar fenómenos no lineales en las señales EEG, como la transición entre vigilia y sueño.
</li>
<li>
En EMG: Mide la complejidad de la señal muscular. Movimientos complejos o transitorios (como espasmos) aumentan esta medida.
</li>
<li>
En EOG: Refleja la complejidad de los movimientos oculares, como transiciones rápidas durante REM.
</li>
<ol start="10" type="1">
<li>higuchi (Dimensión fractal de Higuchi)</li>
</ol>
Otra medida de la complejidad basada en la geometría fractal de la señal EEG.
<li>
En EEG: Valores más altos indican mayor desorganización o actividad caótica.
</li>
<li>
En EMG: Evalúa la estructura fractal de la señal. Es útil para detectar patrones irregulares en la actividad muscular.
</li>
<li>
En EOG: Detecta patrones irregulares en movimientos oculares.
</li>
<ol start="11" type="1">
<li>hmob (Movilidad de Hjorth)</li>
</ol>
Mide la tasa de cambio de la amplitud de la señal, reflejando la velocidad de cambio en el EEG.
<li>
En EEG: Está relacionado con la actividad cortical.
</li>
<li>
En EMG: Refleja la rapidez con la que cambia la señal de EMG, asociada con contracciones musculares rápidas o sostenidas.
</li>
<li>
En EOG: Mide la rapidez de cambio en los movimientos oculares.
</li>
<ol start="12" type="1">
<li>iqr (Rango intercuartílico)</li>
</ol>
Mide la dispersión de la amplitud de la señal entre el percentil 25 y el 75.
<li>
En EEG: Ayuda a eliminar el efecto de valores atípicos en el análisis de amplitud.
</li>
<li>
En EMG: Analiza la variación central de la señal de EMG, eliminando valores extremos que podrían ser artefactos o picos.
</li>
<li>
En EOG: Variabilidad en la amplitud de la señal ocular, eliminando valores extremos (parpadeos).
</li>
<ol start="13" type="1">
<li>kurt (Curtosis)</li>
</ol>
Mide la forma de la distribución de la amplitud de la señal.
<li>
En EEG: Una curtosis elevada indica la presencia de picos o eventos raros de alta amplitud.
</li>
<li>
En EMG: Identifica eventos extremos en la señal, como movimientos bruscos o contracciones repentinas.
</li>
<li>
En EOG: Identifica movimientos oculares extremos, como REM intenso.
</li>
<ol start="14" type="1">
<li>nzc (Cruces por cero)</li>
</ol>
Cuenta el número de veces que la señal cruza el eje cero en un intervalo.
<li>
En EEG: Se relaciona con la frecuencia dominante de la señal.
</li>
<li>
En EMG: Refleja la frecuencia de oscilaciones musculares, útil para analizar patrones repetitivos como temblores.
</li>
<li>
En EOG: Refleja la frecuencia de oscilaciones en los movimientos oculares. Útil para identificar patrones como REM.
</li>
<ol start="15" type="1">
<li>perm (Entropía de permutación)</li>
</ol>
Mide la complejidad de la señal basada en la probabilidad de ocurrencia de patrones específicos en el tiempo.
<li>
En EEG: Se usa para caracterizar la desorganización de las señales EEG.
</li>
<li>
En EMG: Mide la aleatoriedad de la señal muscular. Una mayor entropía indica actividad más desorganizada, como en espasmos o movimientos bruscos.
</li>
<li>
En EOG: Mide la aleatoriedad de los movimientos oculares.
</li>
<ol start="16" type="1">
<li>petrosian (Dimensión fractal de Petrosian)</li>
</ol>
Una medida de la complejidad de la señal basada en cambios abruptos en la dirección del EEG.
<li>
En EEG: Útil para detectar eventos episódicos o transitorios.
</li>
<li>
En EMG: Detecta cambios abruptos en la señal, característicos de movimientos rápidos o actividad muscular transitoria.
</li>
<li>
En EOG: Detecta cambios abruptos en la dirección de los movimientos oculares.
</li>
<ol start="17" type="1">
<li>sdelta (Potencia relativa delta)</li>
</ol>
Representa la proporción de la potencia en el rango delta respecto a la potencia total de la señal.
<li>
En EEG: Se usa para evaluar la calidad del sueño profundo.
</li>
<li>
En EMG: Puede reflejar relajación muscular.
</li>
<li>
En EOG: Proporción de movimientos oculares lentos respecto al total.
</li>
<ol start="18" type="1">
<li>sigma (Potencia en el rango sigma)</li>
</ol>
Potencia en el rango sigma (12-16 Hz), a menudo asociado con los husos del sueño (spindles).
<li>
En EEG: Los husos son importantes para consolidar la memoria durante el sueño.
</li>
<li>
En EMG: Asociada con actividad muscular moderada, como movimientos rítmicos.
</li>
<li>
En EOG: Asociada con movimientos rítmicos o transitorios en frecuencias medias.
</li>
<ol start="19" type="1">
<li>skew (Asimetría o sesgo)</li>
</ol>
Indica el sesgo en la distribución de la amplitud de la señal.
<li>
En EEG: Valores positivos o negativos indican si la señal está más cargada hacia valores altos o bajos.
</li>
<li>
En EMG: Una asimetría elevada puede reflejar contracciones musculares irregulares.
</li>
<li>
En EOG: Refleja la dirección predominante de los movimientos oculares.
</li>
<ol start="20" type="1">
<li>std (Desviación estándar)</li>
</ol>
Refleja la variabilidad de la amplitud de la señal en un intervalo.
<li>
En EEG: Valores más altos indican mayor amplitud promedio.
</li>
<li>
En EMG: Una alta desviación indica contracciones intensas.
</li>
<li>
En EOG: Variabilidad en la amplitud de los movimientos oculares.
</li>
<ol start="21" type="1">
<li>theta (Potencia en el rango theta)</li>
</ol>
Mide la potencia en el rango theta (4-8 Hz).
<li>
En EEG: Asociada con la transición al sueño ligero y actividades relacionadas con el descanso y la relajación.
</li>
<li>
En EMG: Actividad muscular en el rango theta, que puede aparecer en movimientos lentos o relajación muscular.
</li>
<li>
En EOG: Actividad ocular lenta, típica de las primeras etapas del sueño.
</li>
<p>Además, el algoritmo calcula versiones suavizadas y normalizadas de estas características. Específicamente, se aplica un promedio móvil triangular ponderado centrado de 7.5 minutos y un promedio móvil de 2 minutos hacia atrás. Las características suavizadas resultantes se normalizan utilizando un <strong>z-score</strong> robusto.</p>
</section>
<section id="extracción-de-características-1" class="level2">
<h2 class="anchored" data-anchor-id="extracción-de-características-1">4.3 Extracción de características</h2>
<div id="a916caa5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_features(raw_list, labels_list):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    sls_pd <span class="op">=</span> pd.DataFrame()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    paciente <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (raw, labels) <span class="kw">in</span> <span class="bu">zip</span>(raw_list, labels_list):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Obtain features using SleepStaging</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        sls <span class="op">=</span> yasa.SleepStaging(raw, eeg_name <span class="op">=</span><span class="st">'C4-A1'</span>, eog_name<span class="op">=</span><span class="st">'LOC-A2'</span>, emg_name<span class="op">=</span><span class="st">'X1'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Eliminamos las 30 epochs (each 30s)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        sls2 <span class="op">=</span> sls.get_features()[:<span class="op">-</span><span class="dv">30</span>]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        sls2 <span class="op">=</span> sls2.<span class="bu">apply</span>(<span class="kw">lambda</span> x: StandardScaler().fit_transform(x.values.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).flatten())</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        sls2[<span class="st">"paciente"</span>] <span class="op">=</span> paciente</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        sls2[<span class="st">"y"</span>] <span class="op">=</span> labels</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        sls_pd <span class="op">=</span> pd.concat([sls_pd,sls2])</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        paciente <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sls_pd</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>sls_pd <span class="op">=</span> load_features(raw_train_list, labels_train_list)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="07e1a561" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sls_pd.describe()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eeg_abspow</th>
<th data-quarto-table-cell-role="th">eeg_abspow_c7min_norm</th>
<th data-quarto-table-cell-role="th">eeg_abspow_p2min_norm</th>
<th data-quarto-table-cell-role="th">eeg_alpha</th>
<th data-quarto-table-cell-role="th">eeg_alpha_c7min_norm</th>
<th data-quarto-table-cell-role="th">eeg_alpha_p2min_norm</th>
<th data-quarto-table-cell-role="th">eeg_at</th>
<th data-quarto-table-cell-role="th">eeg_at_c7min_norm</th>
<th data-quarto-table-cell-role="th">eeg_at_p2min_norm</th>
<th data-quarto-table-cell-role="th">eeg_beta</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">eog_std</th>
<th data-quarto-table-cell-role="th">eog_std_c7min_norm</th>
<th data-quarto-table-cell-role="th">eog_std_p2min_norm</th>
<th data-quarto-table-cell-role="th">eog_theta</th>
<th data-quarto-table-cell-role="th">eog_theta_c7min_norm</th>
<th data-quarto-table-cell-role="th">eog_theta_p2min_norm</th>
<th data-quarto-table-cell-role="th">time_hour</th>
<th data-quarto-table-cell-role="th">time_norm</th>
<th data-quarto-table-cell-role="th">paciente</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>...</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6.884000e+03</td>
<td>6884.000000</td>
<td>6884.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>6.649675e-09</td>
<td>8.312094e-09</td>
<td>5.541396e-09</td>
<td>-8.035025e-09</td>
<td>-6.649675e-09</td>
<td>3.324838e-09</td>
<td>-4.987257e-09</td>
<td>2.216558e-09</td>
<td>5.541396e-10</td>
<td>-4.433117e-09</td>
<td>...</td>
<td>2.493628e-09</td>
<td>-5.541396e-09</td>
<td>1.662419e-09</td>
<td>-6.095536e-09</td>
<td>6.095536e-09</td>
<td>-2.770698e-09</td>
<td>-2.216558e-09</td>
<td>-2.216558e-09</td>
<td>4.494480</td>
<td>1.961360</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>...</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>1.000073e+00</td>
<td>2.345093</td>
<td>1.302203</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-1.205392e+00</td>
<td>-1.287063e+00</td>
<td>-1.236015e+00</td>
<td>-1.720164e+00</td>
<td>-1.978769e+00</td>
<td>-1.965694e+00</td>
<td>-1.687193e+00</td>
<td>-1.801921e+00</td>
<td>-1.735367e+00</td>
<td>-1.423201e+00</td>
<td>...</td>
<td>-1.268762e+00</td>
<td>-1.664969e+00</td>
<td>-1.663177e+00</td>
<td>-2.326445e+00</td>
<td>-2.311256e+00</td>
<td>-2.579989e+00</td>
<td>-1.730266e+00</td>
<td>-1.730266e+00</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-6.502368e-01</td>
<td>-7.259584e-01</td>
<td>-7.198870e-01</td>
<td>-6.493141e-01</td>
<td>-6.508499e-01</td>
<td>-6.457384e-01</td>
<td>-5.819797e-01</td>
<td>-6.467899e-01</td>
<td>-6.206201e-01</td>
<td>-6.805704e-01</td>
<td>...</td>
<td>-5.898573e-01</td>
<td>-7.376677e-01</td>
<td>-7.049936e-01</td>
<td>-8.566018e-01</td>
<td>-8.492948e-01</td>
<td>-8.630501e-01</td>
<td>-8.660260e-01</td>
<td>-8.660260e-01</td>
<td>2.000000</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-3.425886e-01</td>
<td>-3.493609e-01</td>
<td>-3.490025e-01</td>
<td>-2.589580e-01</td>
<td>-1.610850e-01</td>
<td>-2.088484e-01</td>
<td>-3.333476e-01</td>
<td>-3.140746e-01</td>
<td>-3.365833e-01</td>
<td>-2.955211e-01</td>
<td>...</td>
<td>-2.644548e-01</td>
<td>-2.051610e-01</td>
<td>-2.522085e-01</td>
<td>1.544250e-02</td>
<td>7.113008e-02</td>
<td>6.874630e-02</td>
<td>6.009518e-09</td>
<td>5.667248e-09</td>
<td>5.000000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>3.008010e-01</td>
<td>4.189033e-01</td>
<td>3.918277e-01</td>
<td>3.850904e-01</td>
<td>4.604374e-01</td>
<td>4.329504e-01</td>
<td>1.990274e-01</td>
<td>2.392046e-01</td>
<td>2.004285e-01</td>
<td>3.679619e-01</td>
<td>...</td>
<td>2.571301e-01</td>
<td>5.444317e-01</td>
<td>4.367091e-01</td>
<td>7.463558e-01</td>
<td>8.139084e-01</td>
<td>7.902360e-01</td>
<td>8.660260e-01</td>
<td>8.660259e-01</td>
<td>7.000000</td>
<td>3.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.588387e+01</td>
<td>4.132522e+00</td>
<td>5.664277e+00</td>
<td>6.472775e+00</td>
<td>4.690591e+00</td>
<td>5.609032e+00</td>
<td>9.423945e+00</td>
<td>6.120974e+00</td>
<td>7.308499e+00</td>
<td>8.879319e+00</td>
<td>...</td>
<td>1.217541e+01</td>
<td>5.293070e+00</td>
<td>7.563130e+00</td>
<td>4.276592e+00</td>
<td>2.266431e+00</td>
<td>3.285123e+00</td>
<td>1.730266e+00</td>
<td>1.730266e+00</td>
<td>8.000000</td>
<td>4.000000</td>
</tr>
</tbody>
</table>

<p>8 rows × 151 columns</p>
</div>
</div>
</div>
<section id="análisis-exploratorio" class="level3">
<h3 class="anchored" data-anchor-id="análisis-exploratorio">4.3.1 Análisis Exploratorio</h3>
<ol type="1">
<li>Seleccionamos las variables no normalizadas por la librería yasa</li>
</ol>
<div id="65b1fed8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sls_pd <span class="op">=</span> sls_pd.loc[:, <span class="op">~</span>sls_pd.columns.<span class="bu">str</span>.contains(<span class="st">"norm"</span>)]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sls_pd</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eeg_abspow</th>
<th data-quarto-table-cell-role="th">eeg_alpha</th>
<th data-quarto-table-cell-role="th">eeg_at</th>
<th data-quarto-table-cell-role="th">eeg_beta</th>
<th data-quarto-table-cell-role="th">eeg_db</th>
<th data-quarto-table-cell-role="th">eeg_ds</th>
<th data-quarto-table-cell-role="th">eeg_dt</th>
<th data-quarto-table-cell-role="th">eeg_fdelta</th>
<th data-quarto-table-cell-role="th">eeg_hcomp</th>
<th data-quarto-table-cell-role="th">eeg_higuchi</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">eog_perm</th>
<th data-quarto-table-cell-role="th">eog_petrosian</th>
<th data-quarto-table-cell-role="th">eog_sdelta</th>
<th data-quarto-table-cell-role="th">eog_sigma</th>
<th data-quarto-table-cell-role="th">eog_skew</th>
<th data-quarto-table-cell-role="th">eog_std</th>
<th data-quarto-table-cell-role="th">eog_theta</th>
<th data-quarto-table-cell-role="th">time_hour</th>
<th data-quarto-table-cell-role="th">paciente</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.204255</td>
<td>2.442199</td>
<td>4.737147</td>
<td>0.819560</td>
<td>-0.586997</td>
<td>-0.300928</td>
<td>0.496675</td>
<td>-1.347458</td>
<td>0.085729</td>
<td>1.931064</td>
<td>...</td>
<td>1.378737</td>
<td>1.414004</td>
<td>0.768529</td>
<td>-1.606545</td>
<td>-0.920653</td>
<td>3.938047</td>
<td>-1.925812</td>
<td>-1.730177</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.377479</td>
<td>1.187170</td>
<td>1.427726</td>
<td>1.033913</td>
<td>-0.589886</td>
<td>-0.252050</td>
<td>-0.073450</td>
<td>-0.786755</td>
<td>-0.412876</td>
<td>1.852918</td>
<td>...</td>
<td>1.345153</td>
<td>1.375019</td>
<td>0.129050</td>
<td>-0.931746</td>
<td>-0.143528</td>
<td>2.669825</td>
<td>-1.522801</td>
<td>-1.726428</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.811925</td>
<td>-1.006595</td>
<td>0.350341</td>
<td>0.508354</td>
<td>-0.505752</td>
<td>0.514867</td>
<td>3.581684</td>
<td>-2.291381</td>
<td>0.249585</td>
<td>1.313252</td>
<td>...</td>
<td>1.603657</td>
<td>1.724947</td>
<td>1.244004</td>
<td>-0.357960</td>
<td>0.155308</td>
<td>3.774521</td>
<td>-1.626362</td>
<td>-1.722679</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.152028</td>
<td>-0.023932</td>
<td>0.687935</td>
<td>1.723867</td>
<td>-0.598044</td>
<td>-0.345654</td>
<td>0.504452</td>
<td>-0.201384</td>
<td>0.208895</td>
<td>1.728924</td>
<td>...</td>
<td>1.723065</td>
<td>1.913599</td>
<td>0.945987</td>
<td>-0.664184</td>
<td>-1.417613</td>
<td>2.821598</td>
<td>-1.516837</td>
<td>-1.718930</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.341640</td>
<td>0.245241</td>
<td>0.850940</td>
<td>2.687737</td>
<td>-0.624913</td>
<td>-0.543306</td>
<td>-0.094444</td>
<td>-2.116338</td>
<td>-0.363663</td>
<td>2.065156</td>
<td>...</td>
<td>1.769627</td>
<td>1.981137</td>
<td>-0.668136</td>
<td>0.055046</td>
<td>0.320262</td>
<td>2.344892</td>
<td>-1.685285</td>
<td>-1.715181</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">965</td>
<td>-0.872751</td>
<td>-0.611607</td>
<td>-0.586359</td>
<td>-0.202796</td>
<td>-0.270362</td>
<td>0.073091</td>
<td>-0.020888</td>
<td>0.651496</td>
<td>0.236701</td>
<td>-0.553475</td>
<td>...</td>
<td>-0.168596</td>
<td>-0.214384</td>
<td>1.257746</td>
<td>-0.585616</td>
<td>1.293007</td>
<td>1.066390</td>
<td>0.178290</td>
<td>1.715981</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">966</td>
<td>-0.972657</td>
<td>-0.560571</td>
<td>-0.582334</td>
<td>-0.209954</td>
<td>-0.334050</td>
<td>-0.051904</td>
<td>-0.286460</td>
<td>0.513692</td>
<td>-0.081316</td>
<td>-0.476817</td>
<td>...</td>
<td>0.798112</td>
<td>0.732848</td>
<td>0.149139</td>
<td>0.914641</td>
<td>0.469007</td>
<td>-1.111216</td>
<td>0.598593</td>
<td>1.719553</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">967</td>
<td>-1.052102</td>
<td>-0.683885</td>
<td>-0.611023</td>
<td>-0.326495</td>
<td>-0.234078</td>
<td>-0.030900</td>
<td>-0.244329</td>
<td>0.403498</td>
<td>0.331204</td>
<td>-0.570844</td>
<td>...</td>
<td>0.825327</td>
<td>0.756785</td>
<td>-0.132164</td>
<td>1.167048</td>
<td>0.166480</td>
<td>-1.172419</td>
<td>0.788831</td>
<td>1.723124</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">968</td>
<td>-1.107513</td>
<td>-0.606251</td>
<td>-0.600314</td>
<td>-0.005095</td>
<td>-0.396409</td>
<td>-0.106075</td>
<td>-0.373250</td>
<td>0.346879</td>
<td>0.210917</td>
<td>-0.518657</td>
<td>...</td>
<td>0.559396</td>
<td>0.500999</td>
<td>-0.043348</td>
<td>1.514982</td>
<td>1.198007</td>
<td>-0.107484</td>
<td>1.120008</td>
<td>1.726695</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">969</td>
<td>-1.047791</td>
<td>-0.666564</td>
<td>-0.601002</td>
<td>-0.356518</td>
<td>-0.208053</td>
<td>-0.071030</td>
<td>-0.130115</td>
<td>0.645663</td>
<td>0.540423</td>
<td>-0.563284</td>
<td>...</td>
<td>0.826727</td>
<td>0.764806</td>
<td>0.168520</td>
<td>1.795755</td>
<td>0.409723</td>
<td>-1.127038</td>
<td>0.884924</td>
<td>1.730266</td>
<td>8</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>6884 rows × 52 columns</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Creación de un reporte .html sobre las variables a utilizar.</li>
</ol>
<div id="e2b4f6fd" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate automated report and save it to HTML (comentado debido a su gran coste computacional)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># profile = ProfileReport(sls_pd, title="Sleep Stage Data")</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># profile.to_file("eda.html")</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Dividir el conjunto de datos en Entrenamiento y Validación. Binarizar la variable objetivo.</li>
</ol>
<div id="3e7ffb4f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping for sleep stages</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sleep_stages <span class="op">=</span> {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="st">'Wake'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'N1 sleep'</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'N2 sleep'</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'N3 sleep'</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'REM sleep'</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Train y Validation</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>Xtrain <span class="op">=</span> sls_pd[sls_pd[<span class="st">"paciente"</span>] <span class="op">&lt;=</span> <span class="dv">6</span>].iloc[:,:<span class="op">-</span><span class="dv">3</span>].copy()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>Xtrain <span class="op">=</span> Xtrain.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ytrain <span class="op">=</span> sls_pd[sls_pd[<span class="st">"paciente"</span>] <span class="op">&lt;=</span> <span class="dv">6</span>].loc[:,<span class="st">"y"</span>].copy()</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>ytrain <span class="op">=</span> ytrain.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>Xval<span class="op">=</span> sls_pd[sls_pd[<span class="st">"paciente"</span>] <span class="op">&gt;=</span> <span class="dv">7</span>].iloc[:,:<span class="op">-</span><span class="dv">3</span>].copy()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>yval <span class="op">=</span> sls_pd[sls_pd[<span class="st">"paciente"</span>] <span class="op">&gt;=</span> <span class="dv">7</span>].loc[:,<span class="st">"y"</span>].copy()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Binarize the output</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>ytrain_bin <span class="op">=</span> label_binarize(ytrain, classes<span class="op">=</span><span class="bu">list</span>(sleep_stages.keys()))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>yval_bin <span class="op">=</span> label_binarize(yval, classes<span class="op">=</span><span class="bu">list</span>(sleep_stages.keys()))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualización" class="level3">
<h3 class="anchored" data-anchor-id="visualización">4.3.2 Visualización</h3>
<p>Cambiamos los números de la variable objetivo por los nombres de las etapas correspondientes.</p>
<div id="197bba56" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sleep_stages <span class="op">=</span> {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="st">'Wake'</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'N1'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'N2'</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'N3'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'REM'</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>sls_pd_tidy <span class="op">=</span> sls_pd.drop([<span class="st">"time_hour"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>sls_pd_tidy[<span class="st">"y"</span>] <span class="op">=</span> sls_pd_tidy[<span class="st">"y"</span>].<span class="bu">map</span>(sleep_stages)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>sls_pd_tidy</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eeg_abspow</th>
<th data-quarto-table-cell-role="th">eeg_alpha</th>
<th data-quarto-table-cell-role="th">eeg_at</th>
<th data-quarto-table-cell-role="th">eeg_beta</th>
<th data-quarto-table-cell-role="th">eeg_db</th>
<th data-quarto-table-cell-role="th">eeg_ds</th>
<th data-quarto-table-cell-role="th">eeg_dt</th>
<th data-quarto-table-cell-role="th">eeg_fdelta</th>
<th data-quarto-table-cell-role="th">eeg_hcomp</th>
<th data-quarto-table-cell-role="th">eeg_higuchi</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">eog_nzc</th>
<th data-quarto-table-cell-role="th">eog_perm</th>
<th data-quarto-table-cell-role="th">eog_petrosian</th>
<th data-quarto-table-cell-role="th">eog_sdelta</th>
<th data-quarto-table-cell-role="th">eog_sigma</th>
<th data-quarto-table-cell-role="th">eog_skew</th>
<th data-quarto-table-cell-role="th">eog_std</th>
<th data-quarto-table-cell-role="th">eog_theta</th>
<th data-quarto-table-cell-role="th">paciente</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.204255</td>
<td>2.442199</td>
<td>4.737147</td>
<td>0.819560</td>
<td>-0.586997</td>
<td>-0.300928</td>
<td>0.496675</td>
<td>-1.347458</td>
<td>0.085729</td>
<td>1.931064</td>
<td>...</td>
<td>0.048868</td>
<td>1.378737</td>
<td>1.414004</td>
<td>0.768529</td>
<td>-1.606545</td>
<td>-0.920653</td>
<td>3.938047</td>
<td>-1.925812</td>
<td>1</td>
<td>Wake</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.377479</td>
<td>1.187170</td>
<td>1.427726</td>
<td>1.033913</td>
<td>-0.589886</td>
<td>-0.252050</td>
<td>-0.073450</td>
<td>-0.786755</td>
<td>-0.412876</td>
<td>1.852918</td>
<td>...</td>
<td>0.342036</td>
<td>1.345153</td>
<td>1.375019</td>
<td>0.129050</td>
<td>-0.931746</td>
<td>-0.143528</td>
<td>2.669825</td>
<td>-1.522801</td>
<td>1</td>
<td>Wake</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.811925</td>
<td>-1.006595</td>
<td>0.350341</td>
<td>0.508354</td>
<td>-0.505752</td>
<td>0.514867</td>
<td>3.581684</td>
<td>-2.291381</td>
<td>0.249585</td>
<td>1.313252</td>
<td>...</td>
<td>0.744425</td>
<td>1.603657</td>
<td>1.724947</td>
<td>1.244004</td>
<td>-0.357960</td>
<td>0.155308</td>
<td>3.774521</td>
<td>-1.626362</td>
<td>1</td>
<td>Wake</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.152028</td>
<td>-0.023932</td>
<td>0.687935</td>
<td>1.723867</td>
<td>-0.598044</td>
<td>-0.345654</td>
<td>0.504452</td>
<td>-0.201384</td>
<td>0.208895</td>
<td>1.728924</td>
<td>...</td>
<td>1.664170</td>
<td>1.723065</td>
<td>1.913599</td>
<td>0.945987</td>
<td>-0.664184</td>
<td>-1.417613</td>
<td>2.821598</td>
<td>-1.516837</td>
<td>1</td>
<td>Wake</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.341640</td>
<td>0.245241</td>
<td>0.850940</td>
<td>2.687737</td>
<td>-0.624913</td>
<td>-0.543306</td>
<td>-0.094444</td>
<td>-2.116338</td>
<td>-0.363663</td>
<td>2.065156</td>
<td>...</td>
<td>2.101048</td>
<td>1.769627</td>
<td>1.981137</td>
<td>-0.668136</td>
<td>0.055046</td>
<td>0.320262</td>
<td>2.344892</td>
<td>-1.685285</td>
<td>1</td>
<td>Wake</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">965</td>
<td>-0.872751</td>
<td>-0.611607</td>
<td>-0.586359</td>
<td>-0.202796</td>
<td>-0.270362</td>
<td>0.073091</td>
<td>-0.020888</td>
<td>0.651496</td>
<td>0.236701</td>
<td>-0.553475</td>
<td>...</td>
<td>-0.849758</td>
<td>-0.168596</td>
<td>-0.214384</td>
<td>1.257746</td>
<td>-0.585616</td>
<td>1.293007</td>
<td>1.066390</td>
<td>0.178290</td>
<td>8</td>
<td>REM</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">966</td>
<td>-0.972657</td>
<td>-0.560571</td>
<td>-0.582334</td>
<td>-0.209954</td>
<td>-0.334050</td>
<td>-0.051904</td>
<td>-0.286460</td>
<td>0.513692</td>
<td>-0.081316</td>
<td>-0.476817</td>
<td>...</td>
<td>0.099412</td>
<td>0.798112</td>
<td>0.732848</td>
<td>0.149139</td>
<td>0.914641</td>
<td>0.469007</td>
<td>-1.111216</td>
<td>0.598593</td>
<td>8</td>
<td>REM</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">967</td>
<td>-1.052102</td>
<td>-0.683885</td>
<td>-0.611023</td>
<td>-0.326495</td>
<td>-0.234078</td>
<td>-0.030900</td>
<td>-0.244329</td>
<td>0.403498</td>
<td>0.331204</td>
<td>-0.570844</td>
<td>...</td>
<td>0.085139</td>
<td>0.825327</td>
<td>0.756785</td>
<td>-0.132164</td>
<td>1.167048</td>
<td>0.166480</td>
<td>-1.172419</td>
<td>0.788831</td>
<td>8</td>
<td>REM</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">968</td>
<td>-1.107513</td>
<td>-0.606251</td>
<td>-0.600314</td>
<td>-0.005095</td>
<td>-0.396409</td>
<td>-0.106075</td>
<td>-0.373250</td>
<td>0.346879</td>
<td>0.210917</td>
<td>-0.518657</td>
<td>...</td>
<td>-0.228872</td>
<td>0.559396</td>
<td>0.500999</td>
<td>-0.043348</td>
<td>1.514982</td>
<td>1.198007</td>
<td>-0.107484</td>
<td>1.120008</td>
<td>8</td>
<td>REM</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">969</td>
<td>-1.047791</td>
<td>-0.666564</td>
<td>-0.601002</td>
<td>-0.356518</td>
<td>-0.208053</td>
<td>-0.071030</td>
<td>-0.130115</td>
<td>0.645663</td>
<td>0.540423</td>
<td>-0.563284</td>
<td>...</td>
<td>-0.064730</td>
<td>0.826727</td>
<td>0.764806</td>
<td>0.168520</td>
<td>1.795755</td>
<td>0.409723</td>
<td>-1.127038</td>
<td>0.884924</td>
<td>8</td>
<td>REM</td>
</tr>
</tbody>
</table>

<p>6884 rows × 51 columns</p>
</div>
</div>
</div>
<p>Hacemos el data frame tidy para poder realizar gráficos exploratorios.</p>
<div id="9bf20908" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sls_pd_tidy <span class="op">=</span> sls_pd_tidy.melt(id_vars <span class="op">=</span> [<span class="st">"paciente"</span>,<span class="st">"y"</span>], value_vars <span class="op">=</span> sls_pd_tidy.columns[:<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sls_pd_tidy</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">paciente</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Wake</td>
<td>eeg_abspow</td>
<td>-0.204255</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Wake</td>
<td>eeg_abspow</td>
<td>-0.377479</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Wake</td>
<td>eeg_abspow</td>
<td>2.811925</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Wake</td>
<td>eeg_abspow</td>
<td>0.152028</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Wake</td>
<td>eeg_abspow</td>
<td>-0.341640</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">337311</td>
<td>8</td>
<td>REM</td>
<td>eog_theta</td>
<td>0.178290</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">337312</td>
<td>8</td>
<td>REM</td>
<td>eog_theta</td>
<td>0.598593</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">337313</td>
<td>8</td>
<td>REM</td>
<td>eog_theta</td>
<td>0.788831</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">337314</td>
<td>8</td>
<td>REM</td>
<td>eog_theta</td>
<td>1.120008</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">337315</td>
<td>8</td>
<td>REM</td>
<td>eog_theta</td>
<td>0.884924</td>
</tr>
</tbody>
</table>

<p>337316 rows × 4 columns</p>
</div>
</div>
</div>
<p>Realizamos un boxplot para las variables <code>eeg_abspow</code> y <code>eog_skew</code> para ver las diferencias que muestran en cada fase del sueño. Este gráfico, entre otros, se mostrará en el dashboard final al que tendrá acceso el médico.</p>
<div id="5ee03875" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.catplot(data<span class="op">=</span>sls_pd_tidy[sls_pd_tidy[<span class="st">"variable"</span>].isin([<span class="st">"eeg_abspow"</span>,<span class="st">"eog_skew"</span>])], y<span class="op">=</span><span class="st">"value"</span>, hue<span class="op">=</span><span class="st">"y"</span>, col<span class="op">=</span><span class="st">"variable"</span>, kind <span class="op">=</span> <span class="st">"box"</span>, sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar la leyenda automática</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>g._legend.remove()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar la leyenda personalizada</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">5</span>, loc<span class="op">=</span><span class="st">"lower center"</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-14-output-1.png" width="948" height="502" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Para la variable <code>eeg_abspow</code> observamos cómo obtiene valores más altos y mucha mayor varianza para las fases <code>Wake</code> y <code>N3</code>, mientras que para las otras muestra valores relativamente similares y una menor varianza.</p>
<p>Para la variable <code>eog_skew</code> los valores son muy similares para todas las fases del sueño. La diferencia radica en la varianza en cada fase. Se puede observar cómo para la fase <code>N3</code> la varianza es notablemente menor que en las demás, mientras que en las fase <code>REM</code> y, en menor medida, en la fase <code>Wake</code> observamos una varianza muy elevada.</p>
<p>Ahora realizamos una matriz de correlación que muestra las correlaciones que tienen las variables del dataset entre sí.</p>
<div id="a2a2b435" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(np.corrcoef(Xtrain, rowvar <span class="op">=</span> <span class="va">False</span>), cmap <span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-1.png" width="415" height="412" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Aparte de la obvia correlación máxima que tiene cada variable consigo misma (diagonal principal), observamos varios grupos de variables con correlaciones muy altas, como se puede observar en los cuadrados amarillos (correlación positiva) y los morados (correlación negativa).</p>
</section>
</section>
</section>
<section id="modelado" class="level1">
<h1>5. Modelado</h1>
<section id="algoritmo-xgboost-para-clasificación-de-etapas-del-sueño" class="level2">
<h2 class="anchored" data-anchor-id="algoritmo-xgboost-para-clasificación-de-etapas-del-sueño">5.1 Algoritmo <code>XGBoost</code> para Clasificación de Etapas del Sueño</h2>
<p>XGBoost es una implementación específica de <strong>Random Forest</strong> con <strong>gradient boosting</strong>, que incluye diversas optimizaciones para mejorar el rendimiento y la precisión. Sus ventajas principales incluyen:</p>
<ul>
<li><strong>Regularización:</strong> Incorpora términos de regularización L1 (Lasso) y L2 (Ridge) para prevenir el sobreajuste, algo que no está presente en la implementación de <code>GradientBoosting</code> de <code>scikit-learn</code>.<br>
</li>
<li><strong>Manejo de valores faltantes:</strong> XGBoost tiene capacidad integrada para manejar datos faltantes, a diferencia de la implementación de <code>scikit-learn</code>.<br>
</li>
<li><strong>Paralelización:</strong> Está diseñado para trabajar de manera eficiente en sistemas paralelos y distribuidos, lo que lo hace mucho más rápido que el Boosting estándar de <code>scikit-learn</code>.<br>
</li>
<li><strong>Poda de árboles:</strong> Utiliza una técnica llamada “poda de profundidad máxima” (<em>max depth pruning</em>), que detiene el crecimiento de los árboles cuando ya no aportan valor.</li>
</ul>
<p>Este enfoque combina velocidad, robustez y flexibilidad, haciéndolo ideal para tareas complejas como la clasificación de etapas del sueño.</p>
<section id="interpretabilidad" class="level3">
<h3 class="anchored" data-anchor-id="interpretabilidad">5.1.1 Interpretabilidad</h3>
<p>Para mejorar la interpretabilidad del modelo, se empleará un XGBoost para cada estado de sueño. De este modo, se obtendrá de forma más precisa qué características ha utilizado cada modelo para realizar la predicción. Además, para cada modelo se ha realizado también una version <code>surrogate</code> mediante un árbol de decisión. Este modelo es menos potente que el XGBoost, pero ayuda a la interpretabilidad.</p>
Cabe destacar que se ha realizado un grid search exhaustivo para cada modelo, pero se ha comentado debido a su gran coste computacional. Los parámetros elegidos para cada modelo son aquellos obtenidos mediante el grid search. Se han probado un total de 6 parámetros diferentes, con 3 posibles valores para cada uno:
<li>
learning_rate: Se trata de la velocidad a la que aprende el modelo. Un valor más alto indica una velocidad de aprendizaje mayor. No es recomendable que su valor sea excesivamente alto por el riesgo de <i>overfitting</i>
</li>
<li>
max_depth: Profundidad máxima que puede tener cada árbol. Una profundidad demasiado elevada puede crear <i>overfitting</i>, pero una demasiado baja puede no captar todas las características de los datos.
</li>
<li>
min_child_weight: Es la suma mínima de los pesos de las instancias requeridos para dividir un nodo. Nodos con menor valor del peso establecido no serán divididos.
</li>
<li>
n_estimators: Representa el número de árboles que serán entrenados en el modelo. Un número mayor de árboles puede captar más detalles, pero existe el riesgo de <i>overfitting</i>.
</li>
<li>
reg_alpha: Controla la regularización L1, que penaliza las características menos relevantes al reducir los pesos asociados.
</li>
<li>
reg_lambda: Controla la regularización L2, que penaliza los pesos grandes para evitar que el modelo dependa demasiado de características individuales.
</li>
<p>Primero creamos dos funciones que nos ayudarán a interpretar los resultados:</p>
<li>
show_features: Muestra las 20 variables más importantes para el modelo en orden descendente en base a su <i>cover</i> (número de veces que se utiliza la variable para hacer divisiones en los árboles) y su <i>gain</i> (mejora o reducción del error media de la variable cuando se utiliza para dividir).
</li>
<li>
show_metricas: Muestra un total de 8 métricas para analizar los resultados del modelo.
</li>
<div id="17f4d4ab" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_features(model, max_num_features<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>, figsize <span class="op">=</span> (<span class="dv">8</span>,<span class="dv">12</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    contx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">type</span> <span class="kw">in</span> [<span class="st">"cover"</span>,<span class="st">"gain"</span>]:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        xgb.plot_importance(model, importance_type<span class="op">=</span><span class="bu">type</span>, max_num_features<span class="op">=</span>max_num_features, ax<span class="op">=</span>axes[contx],values_format<span class="op">=</span><span class="st">"</span><span class="sc">{v:.2f}</span><span class="st">"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        axes[contx].set_title(<span class="bu">type</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        axes[contx].set_ylabel(<span class="st">""</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        contx <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(<span class="st">"Feature Importance"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">"Features"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_metricas(n_modelo,y_true, y_pred,multi<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> multi:</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        modo <span class="op">=</span> <span class="st">"weighted"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        auc <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        esp <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        modo <span class="op">=</span> <span class="st">"binary"</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        auc <span class="op">=</span> metrics.roc_auc_score(y_true, y_pred)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        esp <span class="op">=</span> metrics.recall_score(y_true, y_pred, pos_label<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    metricas <span class="op">=</span> {<span class="st">"Modelo"</span>:n_modelo,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Accuracy"</span>:metrics.accuracy_score(y_true, y_pred),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Precision"</span>:metrics.precision_score(y_true, y_pred, average<span class="op">=</span>modo),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"AP"</span>:metrics.average_precision_score(y_true, y_pred),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"AUC"</span>:auc,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Sensibilidad"</span>:metrics.recall_score(y_true, y_pred, average<span class="op">=</span>modo),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Especificidad"</span>:esp,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">"F-Score"</span>:metrics.f1_score(y_true,y_pred,average<span class="op">=</span>modo)}</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> metricas</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>modelos <span class="op">=</span> []</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>metricas <span class="op">=</span> []</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-wake" class="level2">
<h2 class="anchored" data-anchor-id="modelo-wake">5.2 Modelo Wake</h2>
<section id="creación-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo">5.2.1 Creación del modelo</h3>
<p>Primero realizamos el modelo <code>Wake</code>, que distinguirá cuándo el paciente está despierto (Wake) o dormido.</p>
Los parámetros elegidos por el grid search son:
<li>
learning_rate = 0.4
</li>
<li>
max_depth = 5
</li>
<li>
min_child_weight = 1.0
</li>
<li>
n_estimators = 1000
</li>
<li>
reg_alpha = 0.5
</li>
<li>
reg_lambda = 3
</li>
<div id="30fa11ef" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ytrain0index <span class="op">=</span> ytrain[ytrain <span class="op">==</span> <span class="dv">0</span>].index</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ytrain1index <span class="op">=</span> ytrain[ytrain <span class="op">==</span> <span class="dv">1</span>].index</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ytrain2index <span class="op">=</span> ytrain[ytrain <span class="op">==</span> <span class="dv">2</span>].index</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>ytrain3index <span class="op">=</span> ytrain[ytrain <span class="op">==</span> <span class="dv">3</span>].index</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ytrain4index <span class="op">=</span> ytrain[ytrain <span class="op">==</span> <span class="dv">4</span>].index</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="78c3df13" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> sample, seed</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">1234</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> balanced_data_index(ref_class, class1, class2, class3, class4):</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    indexes <span class="op">=</span> np.concatenate((ref_class.values,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        class1[sample(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(class1)), <span class="bu">round</span>(<span class="bu">len</span>(ref_class) <span class="op">/</span> <span class="dv">4</span>))].values,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        class2[sample(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(class2)), <span class="bu">round</span>(<span class="bu">len</span>(ref_class) <span class="op">/</span> <span class="dv">4</span>))].values,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        class3[sample(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(class3)), <span class="bu">round</span>(<span class="bu">len</span>(ref_class) <span class="op">/</span> <span class="dv">4</span>))].values,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        class4[sample(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(class4)), <span class="bu">round</span>(<span class="bu">len</span>(ref_class) <span class="op">/</span> <span class="dv">4</span>))].values),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> indexes</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>ytrainWakeindex <span class="op">=</span> balanced_data_index(ytrain0index, ytrain1index, ytrain2index, ytrain3index, ytrain4index)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="43fda00c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>modelWake <span class="op">=</span> xgb.XGBClassifier(learning_rate<span class="op">=</span><span class="fl">0.4</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                              max_depth<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                              min_child_weight<span class="op">=</span><span class="fl">1.0</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                              n_estimators<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                              reg_alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                              reg_lambda<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">param_grid = {</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    'n_estimators': [1000, 3000, 5000],</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">    'max_depth': [4, 5, 6],</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">    'learning_rate': [0.1, 0.3, 0.4],</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">    'min_child_weight': [1.0, 1.5, 5],</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_alpha': [0, 0.1, 0.5],</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_lambda': [1, 2, 3]</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search = GridSearchCV(</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator=modelWake,</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">    param_grid=param_grid,</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">    scoring='accuracy',</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">    cv=3,</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">    verbose=1,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_jobs=-1</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search.fit(Xtrain,ytrain_bin[:,0])</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Parameters:", grid_search.best_params_)</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Cross-Validation Accuracy:", grid_search.best_score_)</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co">modelWake = grid_search.best_estimator_</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>modelWake.fit(Xtrain.loc[ytrainWakeindex],ytrain_bin[ytrainWakeindex,<span class="dv">0</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              feature_weights=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.4, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=5,
              max_leaves=None, min_child_weight=1.0, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=1000,
              n_jobs=None, num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">objective&nbsp;</td>
<td class="value">'binary:logistic'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">base_score&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">booster&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">callbacks&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bylevel&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">colsample_bynode&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bytree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">device&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">early_stopping_rounds&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">enable_categorical&nbsp;</td>
<td class="value">False</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">eval_metric&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">feature_types&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">feature_weights&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">gamma&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">grow_policy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">importance_type&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">interaction_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">learning_rate&nbsp;</td>
<td class="value">0.4</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_bin&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_cat_threshold&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_cat_to_onehot&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_delta_step&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_depth&nbsp;</td>
<td class="value">5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_leaves&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">min_child_weight&nbsp;</td>
<td class="value">1.0</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">missing&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">monotone_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">multi_strategy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_estimators&nbsp;</td>
<td class="value">1000</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">num_parallel_tree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">random_state&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">reg_alpha&nbsp;</td>
<td class="value">0.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">reg_lambda&nbsp;</td>
<td class="value">3</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">sampling_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">scale_pos_weight&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">subsample&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">tree_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">validate_parameters&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">verbosity&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</section>
<section id="selección-de-características" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-características">5.2.2 Selección de características</h3>
<p>Primero, utilizaremos los valores de Shapley (Shap) para obtener las variables más importantes y cómo afectan estas al modelo.</p>
<div id="ac86f111" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(modelWake)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>shap_values_Wake <span class="op">=</span> explainer.shap_values(Xtrain)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>shap_values_Wake.shape</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(5130, 49)</code></pre>
</div>
</div>
<div id="b71ca394" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values_Wake, Xtrain, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-21-output-1.png" width="734" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>eeg_fdelta</code>, <code>eeg_higuchi</code> y <code>eeg_at</code> son las variables más importantes para el modelo Wake.</p>
Estas variables afectan al modelo de la siguiente manera, interpretando el resultado obtenido:
<li>
eeg_fdelta: Los valores más altos de esta variable afectan negativamente, es decir, si se tiene un valor de eeg_fdelta alto, la predicción del modelo será que el paciente está dormido.
</li>
<li>
eeg_higuchi: Al contrario que en el caso anterior, los valores más altos significarán que el paciente está despierto, y los más bajos, que está durmiendo.
</li>
<li>
eeg_at: Al igual que en la variable eeg_higuchi, pero de manera menos clara, los valores más altos de esta variable indicarán que el paciente está despierto.
</li>
<p>Ahora mostramos por pantalla las variables más importantes para el modelo y observamos si coinciden.</p>
<div id="4b36493b" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>show_features(modelWake)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-22-output-1.png" width="728" height="1062" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Observamos que entre las variables más importantes y, por tanto, las que mejor explican este modelo están <code>eeg_higuchi</code> y <code>eeg_fdelta</code>, al igual que con Shap. Sin embargo, vemos cómo <code>eeg_at</code> no es considerada tan importante y, en su lugar, <code>emg_std</code> sí que lo es.</p>
</section>
<section id="uso-de-surrogate-model-para-la-interpretabilidad" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-surrogate-model-para-la-interpretabilidad">5.2.3 Uso de <code>Surrogate model</code> para la interpretabilidad</h3>
<div id="966179b5" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>surrogateWake_labels <span class="op">=</span> modelWake.predict(Xtrain.loc[ytrainWakeindex])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>surrogateWake_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>surrogateWake_model.fit(Xtrain.loc[ytrainWakeindex],surrogateWake_labels)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plot_tree(surrogateWake_model, filled<span class="op">=</span><span class="va">True</span>, feature_names<span class="op">=</span>Xtrain.columns, class_names<span class="op">=</span>[<span class="st">"Sleep"</span>,<span class="st">"Wake"</span>])</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-23-output-1.png" width="1507" height="758" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas" class="level3">
<h3 class="anchored" data-anchor-id="métricas">5.2.4 Métricas</h3>
<div id="386d5383" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>metricas_Wake <span class="op">=</span> show_metricas(<span class="st">"Wake"</span>,yval_bin[:,<span class="dv">0</span>],modelWake.predict(Xval))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_Wake)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>metricas_Wake</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>{'Modelo': 'Wake',
 'Accuracy': 0.9446978335233751,
 'Precision': 0.9859437751004017,
 'AP': 0.8845271121913789,
 'AUC': 0.9195635299693475,
 'Sensibilidad': 0.8450946643717728,
 'Especificidad': 0.9940323955669225,
 'F-Score': 0.9101019462465245}</code></pre>
</div>
</div>
<p>El modelo obtenido ofrece unas métricas muy buenas, todas ellas por encima de 0.9, con una gran sensibilidad y especificidad.</p>
<div id="b48d2258" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>modelos.append(modelWake)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-n1" class="level2">
<h2 class="anchored" data-anchor-id="modelo-n1">5.3 Modelo N1</h2>
<section id="creación-del-modelo-1" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo-1">5.3.1 Creación del modelo</h3>
<p>Ahora realizamos un modelo para la fase N1 o etapa I del sueño. Esta etapa tiene menos características que la hagan única, así que será más complicado predecirla correctamente.</p>
Los parámetros obtenidos en el grid search son:
<li>
learning_rate = 0.4
</li>
<li>
max_depth = 6
</li>
<li>
min_child_weight = 1.0
</li>
<li>
n_estimators = 1000
</li>
<li>
reg_alpha = 0.5
</li>
<li>
reg_lambda = 1
</li>
<div id="30524d48" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">1234</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ytrainN1index <span class="op">=</span> balanced_data_index(ytrain1index, ytrain0index, ytrain2index, ytrain3index, ytrain4index)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7485e549" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>modelN1 <span class="op">=</span> xgb.XGBClassifier(learning_rate<span class="op">=</span><span class="fl">0.4</span>, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                            max_depth<span class="op">=</span><span class="dv">6</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                            min_child_weight<span class="op">=</span><span class="fl">1.0</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                            n_estimators<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                            reg_alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                            reg_lambda<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">param_grid = {</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">    'n_estimators': [1000, 3000, 5000],</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">    'max_depth': [4, 5, 6],</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">    'learning_rate': [0.1, 0.3, 0.4],</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">    'min_child_weight': [1.0, 1.5, 5],</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_alpha': [0, 0.1, 0.5],</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_lambda': [1, 2, 3]</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search = GridSearchCV(</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator=modelN1,</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">    param_grid=param_grid,</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">    scoring='accuracy',</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">    cv=3,</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">    verbose=1,</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_jobs=-1</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search.fit(Xtrain,ytrain_bin[:,1])</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Parameters:", grid_search.best_params_)</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Cross-Validation Accuracy:", grid_search.best_score_)</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co">modelN1 = grid_search.best_estimator_</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>modelN1.fit(Xtrain.loc[ytrainN1index],ytrain_bin[ytrainN1index,<span class="dv">1</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              feature_weights=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.4, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=6,
              max_leaves=None, min_child_weight=1.0, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=1000,
              n_jobs=None, num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">objective&nbsp;</td>
<td class="value">'binary:logistic'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">base_score&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">booster&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">callbacks&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bylevel&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">colsample_bynode&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bytree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">device&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">early_stopping_rounds&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">enable_categorical&nbsp;</td>
<td class="value">False</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">eval_metric&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">feature_types&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">feature_weights&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">gamma&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">grow_policy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">importance_type&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">interaction_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">learning_rate&nbsp;</td>
<td class="value">0.4</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_bin&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_cat_threshold&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_cat_to_onehot&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_delta_step&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_depth&nbsp;</td>
<td class="value">6</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_leaves&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">min_child_weight&nbsp;</td>
<td class="value">1.0</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">missing&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">monotone_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">multi_strategy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_estimators&nbsp;</td>
<td class="value">1000</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">num_parallel_tree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">random_state&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">reg_alpha&nbsp;</td>
<td class="value">0.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">reg_lambda&nbsp;</td>
<td class="value">1</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">sampling_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">scale_pos_weight&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">subsample&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">tree_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">validate_parameters&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">verbosity&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</section>
<section id="selección-de-características-1" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-características-1">5.3.2 Selección de características</h3>
<p>Primero, utilizaremos los valores de Shapley (Shap) para obtener las variables más importantes y cómo afectan estas al modelo.</p>
<div id="986b2721" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(modelN1)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>shap_values_N1 <span class="op">=</span> explainer.shap_values(Xtrain)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>shap_values_N1.shape</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(5130, 49)</code></pre>
</div>
</div>
<div id="d9a02bac" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values_N1, Xtrain, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-29-output-1.png" width="732" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>eeg_beta</code>, <code>eeg_abspow</code> y <code>eeg_iqr</code> son las variables más importantes para el modelo N1.</p>
Estas variables afectan al modelo de la siguiente manera, interpretando el resultado obtenido:
<li>
eeg_beta: Los valores más bajos de esta variable afectan negativamente, es decir, si se tiene un valor de eeg_beta bajo, la predicción del modelo será que el paciente no está en la fase N1, y si el valor es alto, entonces sí que lo estará.
</li>
<li>
eeg_abspow: Al contrario que en el caso anterior, aunque con muchas más excepciones, los valores más bajos significarán que el paciente está en la fase N1, y los más bajos, que no lo está.
</li>
<li>
eeg_iqr: Al igual que en la variable eeg_abspow, y con menos excpeciones en los valores extremos, los valores más bajos de esta variable indicarán que el paciente está en la fase N1.
</li>
<p>Ahora mostramos las variables más importantes para el modelo y observamos si coinciden con el resultado obtenido en Shap.</p>
<div id="4eca05c0" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>show_features(modelN1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-1.png" width="763" height="1062" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos muchas variables con importancia similar en el modelo. Las más importantes es <code>eeg_abspow</code>, con mucho gain, y <code>eeg_beta</code>, con mucho cover, que ya habían aparecido en Shap. Sin embargo, la variable <code>eeg_iqr</code> no es considerada tan importante en este caso, y tenemos otras variables como <code>emg_hmob</code>, con mucho cover, y <code>eeg_theta</code>, con mucho gain en su lugar.</p>
</section>
<section id="uso-de-surrogate-model-para-la-interpretabilidad-1" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-surrogate-model-para-la-interpretabilidad-1">5.3.3 Uso de <code>Surrogate model</code> para la interpretabilidad</h3>
<div id="328aca18" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>surrogateN1_labels <span class="op">=</span> modelN1.predict(Xtrain)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>surrogateN1_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>surrogateN1_model.fit(Xtrain,surrogateN1_labels)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>plot_tree(surrogateN1_model, filled<span class="op">=</span><span class="va">True</span>, feature_names<span class="op">=</span>Xtrain.columns, class_names<span class="op">=</span>[<span class="st">"No N1"</span>,<span class="st">"N1"</span>])</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-31-output-1.png" width="1507" height="758" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-1" class="level3">
<h3 class="anchored" data-anchor-id="métricas-1">5.3.4 Métricas</h3>
<div id="59d1cade" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>metricas_N1 <span class="op">=</span> show_metricas(<span class="st">"N1"</span>,yval_bin[:,<span class="dv">1</span>],modelN1.predict(Xval))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_N1)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>metricas_N1</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>{'Modelo': 'N1',
 'Accuracy': 0.822690992018244,
 'Precision': 0.3194805194805195,
 'AP': 0.2564018662782949,
 'AUC': 0.7747515655778673,
 'Sensibilidad': 0.7151162790697675,
 'Especificidad': 0.8343868520859671,
 'F-Score': 0.44165170556552963}</code></pre>
</div>
</div>
<p>Tal y como suponíamos, es bastante complicado obtener grandes resultados para esta etapa. Pese a tener un muy buen accuracy y especificidad, sus valores para el AP y la sensibilidad son muy bajos. Por lo tanto, se puede concluir que el rendimiento de este modelo es bastante inferior al del modelo anterior.</p>
<div id="eeb54d17" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>modelos.append(modelN1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-n2" class="level2">
<h2 class="anchored" data-anchor-id="modelo-n2">5.4 Modelo N2</h2>
<section id="creación-del-modelo-2" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo-2">5.4.1 Creación del modelo</h3>
<p>Ahora realizamos un modelo para la fase N2 o etapa II del sueño. Esta etapa es más reconocible que la I, pero sigue teniendo pocas características únicas.</p>
Los parámetros obtenidos en el grid search son:
<li>
learning_rate = 0.3
</li>
<li>
max_depth = 5
</li>
<li>
min_child_weight = 1.5
</li>
<li>
n_estimators = 5000
</li>
<li>
reg_alpha = 0
</li>
<li>
reg_lambda = 3
</li>
<div id="4555e119" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">1234</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>ytrainN2index <span class="op">=</span> balanced_data_index(ytrain2index, ytrain0index, ytrain1index, ytrain3index, ytrain4index)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d617c27b" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>modelN2 <span class="op">=</span> xgb.XGBClassifier(learning_rate<span class="op">=</span><span class="fl">0.3</span>, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                            max_depth<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                            min_child_weight<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                            n_estimators<span class="op">=</span><span class="dv">5000</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                            reg_alpha<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                            reg_lambda<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">param_grid = {</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    'n_estimators': [1000, 3000, 5000],</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    'max_depth': [4, 5, 6],</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    'learning_rate': [0.1, 0.3, 0.4],</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    'min_child_weight': [1.0, 1.5, 5],</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_alpha': [0, 0.1, 0.5],</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_lambda': [1, 2, 3]</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search = GridSearchCV(</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator=modelN2,</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">    param_grid=param_grid,</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">    scoring='accuracy',</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">    cv=3,</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">    verbose=1,</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_jobs=-1</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search.fit(Xtrain,ytrain_bin[:,2])</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Parameters:", grid_search.best_params_)</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Cross-Validation Accuracy:", grid_search.best_score_)</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="co">modelN2 = grid_search.best_estimator_</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>modelN2.fit(Xtrain.loc[ytrainN2index],ytrain_bin[ytrainN2index,<span class="dv">2</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              feature_weights=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.3, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=5,
              max_leaves=None, min_child_weight=1.5, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=5000,
              n_jobs=None, num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">objective&nbsp;</td>
<td class="value">'binary:logistic'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">base_score&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">booster&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">callbacks&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bylevel&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">colsample_bynode&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bytree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">device&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">early_stopping_rounds&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">enable_categorical&nbsp;</td>
<td class="value">False</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">eval_metric&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">feature_types&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">feature_weights&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">gamma&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">grow_policy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">importance_type&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">interaction_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">learning_rate&nbsp;</td>
<td class="value">0.3</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_bin&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_cat_threshold&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_cat_to_onehot&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_delta_step&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_depth&nbsp;</td>
<td class="value">5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_leaves&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">min_child_weight&nbsp;</td>
<td class="value">1.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">missing&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">monotone_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">multi_strategy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_estimators&nbsp;</td>
<td class="value">5000</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">num_parallel_tree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">random_state&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">reg_alpha&nbsp;</td>
<td class="value">0</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">reg_lambda&nbsp;</td>
<td class="value">3</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">sampling_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">scale_pos_weight&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">subsample&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">tree_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">validate_parameters&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">verbosity&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</section>
<section id="selección-de-características-2" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-características-2">5.4.2 Selección de características</h3>
<p>Primero, utilizaremos los valores de Shapley (Shap) para obtener las variables más importantes y cómo afectan estas al modelo.</p>
<div id="dd48a914" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(modelN2)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>shap_values_N2 <span class="op">=</span> explainer.shap_values(Xtrain)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>shap_values_N2.shape</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>(5130, 49)</code></pre>
</div>
</div>
<div id="9e661f99" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values_N2, Xtrain, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-37-output-1.png" width="732" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>eeg_abspow</code>, <code>eeg_kurt</code> y <code>eeg_fdelta</code> son las variables más importantes para el modelo N2.</p>
Estas variables afectan al modelo de la siguiente manera, interpretando el resultado obtenido:
<li>
eeg_abspow: Los valores más altos de esta variable afectan positivamente, es decir, si se tiene un valor de eeg_abspow alto, la predicción del modelo será que el paciente está en la fase N2.
</li>
<li>
eeg_kurt: De la misma manera que en el caso anterior, los valores más altos significarán que el paciente está en la fase N2, y los más bajos, que no lo está.
</li>
<li>
eeg_fdelta: Al igual que en las variables anteriores, pero con mayor claridad en los valores extremos, los valores más altos de esta variable indicarán que el paciente está en la fase N2.
</li>
<p>Ahora mostramos las variables más importantes para el modelo y observamos si coinciden con el resultado obtenido en Shap.</p>
<div id="03cc85d3" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>show_features(modelN2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-38-output-1.png" width="801" height="1062" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Por primera vez obtenemos variables completamente distintas en Shap y en cover y gain. Pese a que este modelo tiene bastantes de importancia similar, ninguna de las principales es <code>eeg_abspow</code>, <code>eeg_kurt</code> o <code>eeg_fdelta</code>. Las que más gain producen son <code>eeg_db</code>, <code>eog_theta</code>, <code>eog_iqr</code> y <code>eeg_std</code>, y las que más cover producen son <code>eeg_db</code>, <code>eog_alpha</code> y <code>eog_std</code>.</p>
</section>
<section id="uso-de-surrogate-model-para-la-interpretabilidad-2" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-surrogate-model-para-la-interpretabilidad-2">5.4.3 Uso de <code>Surrogate model</code> para la interpretabilidad</h3>
<div id="21429d19" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>surrogateN2_labels <span class="op">=</span> modelN2.predict(Xtrain)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>surrogateN2_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>surrogateN2_model.fit(Xtrain,surrogateN2_labels)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plot_tree(surrogateN2_model, filled<span class="op">=</span><span class="va">True</span>, feature_names<span class="op">=</span>Xtrain.columns, class_names<span class="op">=</span>[<span class="st">"No N2"</span>,<span class="st">"N2"</span>])</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-39-output-1.png" width="1507" height="758" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-2" class="level3">
<h3 class="anchored" data-anchor-id="métricas-2">5.4.4 Métricas</h3>
<div id="88c42c3f" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>metricas_N2 <span class="op">=</span> show_metricas(<span class="st">"N2"</span>,yval_bin[:,<span class="dv">2</span>],modelN2.predict(Xval))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_N2)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>metricas_N2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>{'Modelo': 'N2',
 'Accuracy': 0.806157354618016,
 'Precision': 0.5076400679117148,
 'AP': 0.46341853586567117,
 'AUC': 0.8251639152025614,
 'Sensibilidad': 0.8567335243553008,
 'Especificidad': 0.7935943060498221,
 'F-Score': 0.6375266524520256}</code></pre>
</div>
</div>
<p>El resultado obtenido es bastante decente. Pese a tener una precisión bastante baja, su accuracy, su sensibilidad y su especificidad son bastante buenos (&gt;0.8), por lo tanto se puede concluir que se trata de un modelo bastante bueno.</p>
<div id="8b84b783" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>modelos.append(modelN2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-n3" class="level2">
<h2 class="anchored" data-anchor-id="modelo-n3">5.5 Modelo N3</h2>
<section id="creación-del-modelo-3" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo-3">5.5.1 Creación del modelo</h3>
<p>El siguiente modelo tratará de predecir la fase N3 o <i>slow wave</i>, bastante reconocible debido a la gran amplitud que muestran los distintos valores medidos.</p>
Los parámetros obtenidos en el grid search son:
<li>
learning_rate = 0.4
</li>
<li>
max_depth = 6
</li>
<li>
min_child_weight = 1.0
</li>
<li>
n_estimators = 1000
</li>
<li>
reg_alpha = 0.5
</li>
<li>
reg_lambda = 1
</li>
<div id="264dd0ed" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">1234</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ytrainN3index <span class="op">=</span> balanced_data_index(ytrain3index, ytrain0index, ytrain1index, ytrain2index, ytrain4index)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6779dea7" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>modelN3 <span class="op">=</span> xgb.XGBClassifier(learning_rate<span class="op">=</span><span class="fl">0.4</span>, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                            max_depth<span class="op">=</span><span class="dv">6</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                            min_child_weight<span class="op">=</span><span class="fl">1.0</span>, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                            n_estimators<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                            reg_alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                            reg_lambda<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">param_grid = {</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">    'n_estimators': [1000, 3000, 5000],</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">    'max_depth': [4, 5, 6],</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">    'learning_rate': [0.1, 0.3, 0.4],</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">    'min_child_weight': [1.0, 1.5, 5],</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_alpha': [0, 0.1, 0.5],</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_lambda': [1, 2, 3]</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search = GridSearchCV(</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator=modelN3,</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co">    param_grid=param_grid,</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">    scoring='accuracy',</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co">    cv=3,</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co">    verbose=1,</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_jobs=-1</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search.fit(Xtrain,ytrain_bin[:,3])</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Parameters:", grid_search.best_params_)</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Cross-Validation Accuracy:", grid_search.best_score_)</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="co">modelN3 = grid_search.best_estimator_</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>modelN3.fit(Xtrain.loc[ytrainN3index],ytrain_bin[ytrainN3index,<span class="dv">3</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              feature_weights=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.4, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=6,
              max_leaves=None, min_child_weight=1.0, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=1000,
              n_jobs=None, num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">objective&nbsp;</td>
<td class="value">'binary:logistic'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">base_score&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">booster&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">callbacks&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bylevel&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">colsample_bynode&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bytree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">device&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">early_stopping_rounds&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">enable_categorical&nbsp;</td>
<td class="value">False</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">eval_metric&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">feature_types&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">feature_weights&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">gamma&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">grow_policy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">importance_type&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">interaction_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">learning_rate&nbsp;</td>
<td class="value">0.4</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_bin&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_cat_threshold&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_cat_to_onehot&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_delta_step&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_depth&nbsp;</td>
<td class="value">6</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_leaves&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">min_child_weight&nbsp;</td>
<td class="value">1.0</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">missing&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">monotone_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">multi_strategy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_estimators&nbsp;</td>
<td class="value">1000</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">num_parallel_tree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">random_state&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">reg_alpha&nbsp;</td>
<td class="value">0.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">reg_lambda&nbsp;</td>
<td class="value">1</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">sampling_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">scale_pos_weight&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">subsample&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">tree_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">validate_parameters&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">verbosity&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</section>
<section id="selección-de-características-3" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-características-3">5.5.2 Selección de características</h3>
<p>Primero, utilizaremos los valores de Shapley (Shap) para obtener las variables más importantes y cómo afectan estas al modelo.</p>
<div id="116cba83" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(modelN3)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>shap_values_N3 <span class="op">=</span> explainer.shap_values(Xtrain)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>shap_values_N3.shape</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>(5130, 49)</code></pre>
</div>
</div>
<div id="6506569b" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values_N3, Xtrain, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-45-output-1.png" width="731" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>eeg_db</code>, <code>eeg_iqr</code> y <code>eog_higuchi</code> son las variables más importantes para el modelo N3.</p>
Estas variables afectan al modelo de la siguiente manera, interpretando el resultado obtenido:
<li>
eeg_db: Los valores más bajos de esta variable afectan negativamente de manera bastante clara, es decir, si se tiene un valor de eeg_db bajo, la predicción del modelo será que el paciente no está en la fase N3, mientras que si el valor es muy alto, significará que sí que lo está.
</li>
<li>
eeg_iqr: Al igual que en el caso anterior, los valores más altos significarán que el paciente está en la fase N3, y los más bajos, que no lo está.
</li>
<li>
eog_higuchi: Al contrario que en las variables anteriores, los valores más altos de esta variable indicarán que el paciente no está en la fase N3, y lo más altos, que sí.
</li>
<p>Ahora mostramos las variables más importantes para el modelo y observamos si coinciden con el resultado obtenido en Shap.</p>
<div id="9fd92d85" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>show_features(modelN3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-46-output-1.png" width="720" height="1062" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Con mucha diferencia, la variable más importante para este modelo es <code>eeg_db</code>, que coincide con el resultado obtenido en Shap, aunque también es bastante importante <code>eog_petrosian</code>, la cual aparece bastante más abajo en Shap, pero con una larga cola que indica que los valores más bajos están en la fase N3. La siguiente más importante es, al igual que en Shap, <code>eeg_iqr</code>.</p>
</section>
<section id="uso-de-surrogate-model-para-la-interpretabilidad-3" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-surrogate-model-para-la-interpretabilidad-3">5.5.3 Uso de <code>Surrogate model</code> para la interpretabilidad</h3>
<div id="e3caa0ff" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>surrogateN3_labels <span class="op">=</span> modelN3.predict(Xtrain)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>surrogateN3_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>surrogateN3_model.fit(Xtrain,surrogateN3_labels)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>plot_tree(surrogateN3_model, filled<span class="op">=</span><span class="va">True</span>, feature_names<span class="op">=</span>Xtrain.columns, class_names<span class="op">=</span>[<span class="st">"No N3"</span>,<span class="st">"N3"</span>])</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-1.png" width="1507" height="758" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-3" class="level3">
<h3 class="anchored" data-anchor-id="métricas-3">5.5.4 Métricas</h3>
<div id="9ddc1f55" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>metricas_N3 <span class="op">=</span> show_metricas(<span class="st">"N3"</span>,yval_bin[:,<span class="dv">3</span>],modelN3.predict(Xval))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_N3)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>metricas_N3</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>{'Modelo': 'N3',
 'Accuracy': 0.9236031927023945,
 'Precision': 0.7952069716775599,
 'AP': 0.7394730286156378,
 'AUC': 0.9157766612671481,
 'Sensibilidad': 0.9012345679012346,
 'Especificidad': 0.9303187546330616,
 'F-Score': 0.8449074074074074}</code></pre>
</div>
</div>
<p>Los valores obtenidos en las métricas son muy buenos, con un accuracy, una sensibilidad y una especificidad de más de 0.9, podemos afirmar que el modelo en cuestión obtiene unos resultados muy buenos.</p>
<div id="b67c107e" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>modelos.append(modelN3)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-rem" class="level2">
<h2 class="anchored" data-anchor-id="modelo-rem">5.6 Modelo REM</h2>
<section id="creación-del-modelo-4" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo-4">5.6.1 Creación del modelo</h3>
<p>Por último, realizamos el modelo para la fase REM (Rapid-eye movement), que como su nombre indica, tiene como característica principal el movimiento rápido de los ojos.</p>
Los parámetros obtenidos en el grid search son:
<li>
learning_rate = 0.4
</li>
<li>
max_depth = 5
</li>
<li>
min_child_weight = 1.5
</li>
<li>
n_estimators = 1000
</li>
<li>
reg_alpha = 0.5
</li>
<li>
reg_lambda = 2
</li>
<div id="3039a30e" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>seed(<span class="dv">1234</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>ytrainREMindex <span class="op">=</span> balanced_data_index(ytrain4index, ytrain0index, ytrain1index, ytrain2index, ytrain3index)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="33c8f5d9" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>modelREM <span class="op">=</span> xgb.XGBClassifier(learning_rate<span class="op">=</span><span class="fl">0.4</span>, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                             max_depth<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                             min_child_weight<span class="op">=</span><span class="fl">1.5</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                             n_estimators<span class="op">=</span><span class="dv">1000</span>, </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                             reg_alpha<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                             reg_lambda<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">param_grid = {</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">    'n_estimators': [1000, 3000, 5000],</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">    'max_depth': [4, 5, 6],</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">    'learning_rate': [0.1, 0.3, 0.4],</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">    'min_child_weight': [1.0, 1.5, 5],</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_alpha': [0, 0.1, 0.5],</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">    'reg_lambda': [1, 2, 3]</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search = GridSearchCV(</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">    estimator=modelREM,</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">    param_grid=param_grid,</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">    scoring='accuracy',</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co">    cv=3,</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">    verbose=1,</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_jobs=-1</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="co">grid_search.fit(Xtrain,ytrain_bin[:,4])</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Parameters:", grid_search.best_params_)</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="co">print("Best Cross-Validation Accuracy:", grid_search.best_score_)</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="co">modelREM = grid_search.best_estimator_</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>modelREM.fit(Xtrain.loc[ytrainREMindex],ytrain_bin[ytrainREMindex,<span class="dv">4</span>])</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-5 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              feature_weights=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=0.4, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=5,
              max_leaves=None, min_child_weight=1.5, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=1000,
              n_jobs=None, num_parallel_tree=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>XGBClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">objective&nbsp;</td>
<td class="value">'binary:logistic'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">base_score&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">booster&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">callbacks&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bylevel&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">colsample_bynode&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">colsample_bytree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">device&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">early_stopping_rounds&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">enable_categorical&nbsp;</td>
<td class="value">False</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">eval_metric&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">feature_types&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">feature_weights&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">gamma&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">grow_policy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">importance_type&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">interaction_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">learning_rate&nbsp;</td>
<td class="value">0.4</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_bin&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_cat_threshold&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_cat_to_onehot&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_delta_step&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">max_depth&nbsp;</td>
<td class="value">5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">max_leaves&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">min_child_weight&nbsp;</td>
<td class="value">1.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">missing&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">monotone_constraints&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">multi_strategy&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_estimators&nbsp;</td>
<td class="value">1000</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">num_parallel_tree&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">random_state&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">reg_alpha&nbsp;</td>
<td class="value">0.5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">reg_lambda&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">sampling_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">scale_pos_weight&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">subsample&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">tree_method&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">validate_parameters&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">verbosity&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</section>
<section id="selección-de-características-4" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-características-4">5.6.2 Selección de características</h3>
<p>Primero, utilizaremos los valores de Shapley (Shap) para obtener las variables más importantes y cómo afectan estas al modelo.</p>
<div id="bd286d38" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(modelREM)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>shap_values_REM <span class="op">=</span> explainer.shap_values(Xtrain)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>shap_values_REM.shape</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>(5130, 49)</code></pre>
</div>
</div>
<div id="4e3b9f9b" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values_REM, Xtrain, show<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-53-output-1.png" width="733" height="900" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>eeg_abspow</code>, <code>emg_nzc</code> y <code>emg_iqr</code> son las variables más importantes para el modelo REM.</p>
Estas variables afectan al modelo de la siguiente manera, interpretando el resultado obtenido:
<li>
eeg_abspow: Los valores más altos de esta variable afectan negativamente, es decir, si se tiene un valor de eeg_abspow alto, la predicción del modelo será que el paciente no está en la fase REM.
</li>
<li>
emg_nzc: Al igual que en el caso anterior, y aparentemente de manera bastante más clara, los valores más altos significarán que el paciente no está en la fase REM, y los más bajos, que sí lo está.
</li>
<li>
emg_iqr: Al igual que en las variables anteriores, pero de manera menos clara salvo para los valores muy elevados, los valores más altos de esta variable indicarán que el paciente no está en la fase REM.
</li>
<p>Ahora mostramos las variables más importantes para el modelo y observamos si coinciden con el resultado obtenido en Shap.</p>
<div id="78a3c527" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>show_features(modelREM)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-54-output-1.png" width="726" height="1062" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos que <code>emg_nzc</code> y <code>eeg_abspow</code>, al igual que en Shap, son variables muy importantes para el modelo. Sin embargo, la variable <code>emg_iqr</code> ahora no aparece entre las más importantes, ocupando su lugar <code>eog_hcomp</code>.</p>
</section>
<section id="uso-de-surrogate-model-para-la-interpretabilidad-4" class="level3">
<h3 class="anchored" data-anchor-id="uso-de-surrogate-model-para-la-interpretabilidad-4">5.6.3 Uso de <code>Surrogate model</code> para la interpretabilidad</h3>
<div id="2c70d45d" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>surrogateREM_labels <span class="op">=</span> modelREM.predict(Xtrain)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>surrogateREM_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>, max_depth<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>surrogateREM_model.fit(Xtrain,surrogateREM_labels)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">10</span>))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>plot_tree(surrogateREM_model, filled<span class="op">=</span><span class="va">True</span>, feature_names<span class="op">=</span>Xtrain.columns, class_names<span class="op">=</span>[<span class="st">"No REM"</span>,<span class="st">"REM"</span>])</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-55-output-1.png" width="1507" height="758" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="métricas-4" class="level3">
<h3 class="anchored" data-anchor-id="métricas-4">5.6.4 Métricas</h3>
<div id="9c8ec7e4" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>metricas_REM <span class="op">=</span> show_metricas(<span class="st">"REM"</span>,yval_bin[:,<span class="dv">4</span>],modelREM.predict(Xval))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_REM)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>metricas_REM</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>{'Modelo': 'REM',
 'Accuracy': 0.951539338654504,
 'Precision': 0.7579617834394905,
 'AP': 0.73547487159571,
 'AUC': 0.956565716266062,
 'Sensibilidad': 0.9635627530364372,
 'Especificidad': 0.9495686794956868,
 'F-Score': 0.8484848484848485}</code></pre>
</div>
</div>
<p>Obtenemos una especificidad excelente, así como grandes resultados en accuracy y precisión. Su principal debilidad es una sensibilidad bastante baja, por lo que se trata de un modelo bueno, pero no ideal.</p>
<div id="a99341d2" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>modelos.append(modelREM)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelo-global" class="level2">
<h2 class="anchored" data-anchor-id="modelo-global">5.7 Modelo Global</h2>
<section id="creación-del-modelo-5" class="level3">
<h3 class="anchored" data-anchor-id="creación-del-modelo-5">5.7.1 Creación del modelo</h3>
<div id="2ac3b649" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_model_XGBoost(modelos, X):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    predicciones <span class="op">=</span> modelos[<span class="dv">0</span>].predict(X)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">5</span>):</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>        predicciones <span class="op">=</span> np.column_stack((predicciones,modelos[col].predict(X)))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predicciones</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="métricas-5" class="level3">
<h3 class="anchored" data-anchor-id="métricas-5">5.7.2 Métricas</h3>
<p>Ahora utilizaremos el conjunto de validación separado anteriormente para observar los resultados con un conjunto nuevo de datos antes de hacerlo con el test.</p>
<div id="d6335a97" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>pred_global <span class="op">=</span> predict_model_XGBoost(modelos,Xval)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>metricas_global <span class="op">=</span> show_metricas(<span class="st">"Global"</span>, yval_bin, pred_global, <span class="va">True</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>metricas.append(metricas_global)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>metricas_global</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>{'Modelo': 'Global',
 'Accuracy': 0.621436716077537,
 'Precision': 0.7492735179156995,
 'AP': 0.6158590829093387,
 'AUC': None,
 'Sensibilidad': 0.8643101482326112,
 'Especificidad': None,
 'F-Score': 0.7861991923648894}</code></pre>
</div>
</div>
<p>Creamos una matriz de confusión que nos ayuden a observar la proporción de los valores acertados, así como cuál ha sido la predicción cuando no ha acertado.</p>
<div id="6bf8dd64" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> procesar_filas(predicciones):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> predicciones:</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">sum</span>(row) <span class="op">&gt;=</span> <span class="dv">1</span>:</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>            results.append(np.argmax(row))  <span class="co"># Índice del valor más alto</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>            results.append(<span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(results)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>clases_pred <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>clases_label_pred <span class="op">=</span> [<span class="st">'Wake'</span>, <span class="st">'N1'</span>, <span class="st">'N2'</span>, <span class="st">'N3'</span>, <span class="st">'REM'</span>, <span class="st">'-2'</span>]</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>clases <span class="op">=</span> [<span class="st">'Wake'</span>, <span class="st">'N1'</span>, <span class="st">'N2'</span>, <span class="st">'N3'</span>, <span class="st">'REM'</span>]</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>yval_idx <span class="op">=</span> np.argmax(yval_bin, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>pred_idx <span class="op">=</span> procesar_filas(pred_global)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear una matriz de ceros</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>matriz_confusion <span class="op">=</span> np.zeros((<span class="bu">len</span>(clases), <span class="bu">len</span>(clases_pred)))</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(clases)):</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(clases_pred)):</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calcular la proporción entre clases</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>        matriz_confusion[i, j] <span class="op">=</span> np.<span class="bu">sum</span>((yval_idx <span class="op">==</span> i) <span class="op">&amp;</span> (pred_idx <span class="op">==</span> clases_pred[j])) <span class="op">/</span> np.<span class="bu">sum</span>(yval_idx <span class="op">==</span> i)</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>confusion_df <span class="op">=</span> pd.DataFrame(matriz_confusion, index<span class="op">=</span>clases, columns<span class="op">=</span>clases_label_pred)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tabla de proporciones:"</span>)</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_df)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tabla de proporciones:
          Wake        N1        N2        N3       REM        -2
Wake  0.845095  0.129088  0.017212  0.000000  0.001721  0.006885
N1    0.017442  0.703488  0.226744  0.005814  0.046512  0.000000
N2    0.008596  0.206304  0.687679  0.080229  0.005731  0.011461
N3    0.002469  0.007407  0.254321  0.735802  0.000000  0.000000
REM   0.000000  0.238866  0.076923  0.000000  0.672065  0.012146</code></pre>
</div>
</div>
<p>En general, obtenemos unos resultados bastante decentes, puesto que en general obtenemos resultados de 0.75-0.8 en la mayoría de las métricas, lo que indica que los modelos en general son bastante buenos y tienen altas capacidades. Asimismo, destaca como el 25% de los N1 no ha sido capaz de identificarlos y que el 35% lo ha identificado como N2. Por otro lado, la fase REM tampoco ofrece seguridad ya que el 24% lo ha asignado a N2 y el 21% no ha sido capaz de identificarlo. De este modo, se puede concluir que estas son las dos etapas más difíciles de predecir.</p>
<div id="3f3320df" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>metricas <span class="op">=</span> pd.DataFrame(metricas)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>metricas</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Modelo</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
<th data-quarto-table-cell-role="th">Precision</th>
<th data-quarto-table-cell-role="th">AP</th>
<th data-quarto-table-cell-role="th">AUC</th>
<th data-quarto-table-cell-role="th">Sensibilidad</th>
<th data-quarto-table-cell-role="th">Especificidad</th>
<th data-quarto-table-cell-role="th">F-Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Wake</td>
<td>0.944698</td>
<td>0.985944</td>
<td>0.884527</td>
<td>0.919564</td>
<td>0.845095</td>
<td>0.994032</td>
<td>0.910102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>N1</td>
<td>0.822691</td>
<td>0.319481</td>
<td>0.256402</td>
<td>0.774752</td>
<td>0.715116</td>
<td>0.834387</td>
<td>0.441652</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>N2</td>
<td>0.806157</td>
<td>0.507640</td>
<td>0.463419</td>
<td>0.825164</td>
<td>0.856734</td>
<td>0.793594</td>
<td>0.637527</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>N3</td>
<td>0.923603</td>
<td>0.795207</td>
<td>0.739473</td>
<td>0.915777</td>
<td>0.901235</td>
<td>0.930319</td>
<td>0.844907</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>REM</td>
<td>0.951539</td>
<td>0.757962</td>
<td>0.735475</td>
<td>0.956566</td>
<td>0.963563</td>
<td>0.949569</td>
<td>0.848485</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Global</td>
<td>0.621437</td>
<td>0.749274</td>
<td>0.615859</td>
<td>NaN</td>
<td>0.864310</td>
<td>NaN</td>
<td>0.786199</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observando todos los resultados juntos, vemos cómo el accuracy se ve penalizado al utilizar el conjunto de validación, pero el resto de variables dan aproximadamente el resultado esperado al observar su comportamiento previo.</p>
<p>Ahora creamos una nueva función que nos permite reproducir la curva ROC para cada uno de los modelos en base a sus predicciones.</p>
<div id="b839af15" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> observe_results(pred, y):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (label,col) <span class="kw">in</span> <span class="bu">zip</span>(sleep_stages.values(),np.arange(y.shape[<span class="dv">1</span>])):</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        fpr, tpr, thresholds <span class="op">=</span> roc_curve(y[:,col], pred[:,col])</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="sc">%s</span><span class="st"> AUC: </span><span class="sc">%f</span><span class="st">"</span> <span class="op">%</span> (label,auc(fpr,tpr)))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>        plt.plot(fpr,tpr, label<span class="op">=</span>label)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Curva ROC"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Primero, observamos los resultados si utilizamos el conjunto de entrenamiento.</p>
<div id="660fa54d" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>observe_results(predict_model_XGBoost(modelos, Xtrain), ytrain_bin)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wake AUC: 0.978418
N1 AUC: 0.915008
N2 AUC: 0.969835
N3 AUC: 0.965119
REM AUC: 0.977268</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-63-output-2.png" width="571" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La curva ROC que obtenemos es perfecta para todos los modelos, lo cual significa que puede predecir los datos del conjunto de entrenamiento a la perfección. Esto en general no se trata de un reflejo de las capacidades del modelo, puesto que estos son los datos con los que ha sido entrenado. A continuación se realizarán pruebas que serán más importantes a la hora de justificar la bondad de los modelos.</p>
<p>Ahora utilizamos el conjunto de validación.</p>
<div id="85364bb4" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>observe_results(predict_model_XGBoost(modelos, Xval.values), yval_bin)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wake AUC: 0.919564
N1 AUC: 0.774752
N2 AUC: 0.825164
N3 AUC: 0.915777
REM AUC: 0.956566</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-64-output-2.png" width="571" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Ahora se observan mejor las capacidades reales de los modelos. Tenemos modelos como <code>Wake</code> y <code>N3</code> con capacidades muy altas y que son capaces de predecir sus respectivas fases de manera satisfactoria. En cambio, otros modelos como <code>REM</code> o, principalmente, <code>N1</code> no son capaces de captar sus fases tan bien, y pese a que no ofrecen resultados muy malos, puesto que son capaces de obtener bastante información correctamente, están bastante lejos de llegar a las capacidades de predicción de los modelos con mejores resultados.</p>
</section>
</section>
</section>
<section id="uso-del-conjunto-de-test" class="level1">
<h1>6. Uso del conjunto de test</h1>
<p>Por último, vamos a utilizar el conjunto de test, que será la prueba definitiva para todos nuestros modelos. Dentro de este conjunto tenemos a dos pacientes, los cuales será tratados y analizados de manera independiente.</p>
<div id="32ef5390" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> comparar_hipnogramas(y_true,y_pred):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>, figsize <span class="op">=</span> (<span class="dv">8</span>,<span class="dv">12</span>))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    yasa.plot_hypnogram(y_true,ax<span class="op">=</span>axes[<span class="dv">0</span>], fill_color<span class="op">=</span><span class="st">"thistle"</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="st">"Original"</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    yasa.plot_hypnogram(y_pred,ax<span class="op">=</span>axes[<span class="dv">1</span>], fill_color<span class="op">=</span><span class="st">"thistle"</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].set_title(<span class="st">"Predicción"</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Primero, cargamos los datos del conjunto de test y los observamos.</p>
<div id="34b82c18" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>raw_test_list <span class="op">=</span> load_raw(test<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>labels_test_list <span class="op">=</span> load_labels(test<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>sls_test_pd <span class="op">=</span> load_features(raw_test_list, labels_test_list)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>sls_test_pd <span class="op">=</span> sls_test_pd.loc[:, <span class="op">~</span>sls_test_pd.columns.<span class="bu">str</span>.contains(<span class="st">"norm"</span>)]</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>sls_test_pd</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eeg_abspow</th>
<th data-quarto-table-cell-role="th">eeg_alpha</th>
<th data-quarto-table-cell-role="th">eeg_at</th>
<th data-quarto-table-cell-role="th">eeg_beta</th>
<th data-quarto-table-cell-role="th">eeg_db</th>
<th data-quarto-table-cell-role="th">eeg_ds</th>
<th data-quarto-table-cell-role="th">eeg_dt</th>
<th data-quarto-table-cell-role="th">eeg_fdelta</th>
<th data-quarto-table-cell-role="th">eeg_hcomp</th>
<th data-quarto-table-cell-role="th">eeg_higuchi</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">eog_perm</th>
<th data-quarto-table-cell-role="th">eog_petrosian</th>
<th data-quarto-table-cell-role="th">eog_sdelta</th>
<th data-quarto-table-cell-role="th">eog_sigma</th>
<th data-quarto-table-cell-role="th">eog_skew</th>
<th data-quarto-table-cell-role="th">eog_std</th>
<th data-quarto-table-cell-role="th">eog_theta</th>
<th data-quarto-table-cell-role="th">time_hour</th>
<th data-quarto-table-cell-role="th">paciente</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.577000</td>
<td>3.570615</td>
<td>2.885325</td>
<td>1.416433</td>
<td>-0.579539</td>
<td>-0.480961</td>
<td>-0.477546</td>
<td>-1.191270</td>
<td>0.194938</td>
<td>1.656745</td>
<td>...</td>
<td>0.493204</td>
<td>0.414215</td>
<td>-0.376557</td>
<td>0.349555</td>
<td>-3.461859</td>
<td>3.626038</td>
<td>-1.071073</td>
<td>-1.730207</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.294118</td>
<td>0.460177</td>
<td>2.363127</td>
<td>0.025177</td>
<td>-0.489585</td>
<td>0.243759</td>
<td>1.807320</td>
<td>-2.552401</td>
<td>1.133083</td>
<td>1.309585</td>
<td>...</td>
<td>0.301703</td>
<td>0.200737</td>
<td>1.486327</td>
<td>-0.662080</td>
<td>0.789957</td>
<td>2.048971</td>
<td>-1.392077</td>
<td>-1.726518</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-0.561781</td>
<td>7.660842</td>
<td>9.371770</td>
<td>0.983414</td>
<td>-0.577132</td>
<td>-0.493014</td>
<td>-0.230298</td>
<td>-1.360372</td>
<td>-1.304288</td>
<td>2.084335</td>
<td>...</td>
<td>1.033779</td>
<td>1.055054</td>
<td>-0.109843</td>
<td>0.411031</td>
<td>0.870191</td>
<td>-0.309516</td>
<td>-1.059500</td>
<td>-1.722829</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.490759</td>
<td>1.808041</td>
<td>3.258205</td>
<td>0.314457</td>
<td>-0.538019</td>
<td>-0.229619</td>
<td>0.579576</td>
<td>-1.451907</td>
<td>0.390476</td>
<td>1.327566</td>
<td>...</td>
<td>0.507421</td>
<td>0.424365</td>
<td>0.823534</td>
<td>-0.436802</td>
<td>-0.077194</td>
<td>0.100059</td>
<td>-1.178166</td>
<td>-1.719140</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.715196</td>
<td>3.767046</td>
<td>2.635906</td>
<td>1.298027</td>
<td>-0.579379</td>
<td>-0.540382</td>
<td>-0.615988</td>
<td>-0.562933</td>
<td>-0.993835</td>
<td>1.637304</td>
<td>...</td>
<td>0.682990</td>
<td>0.647140</td>
<td>-0.048462</td>
<td>0.312877</td>
<td>1.030558</td>
<td>-0.321157</td>
<td>-0.897610</td>
<td>-1.715451</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">761</td>
<td>0.337028</td>
<td>-0.666230</td>
<td>-0.914733</td>
<td>-0.758604</td>
<td>0.240142</td>
<td>0.080645</td>
<td>-0.163735</td>
<td>1.107117</td>
<td>0.923960</td>
<td>-0.890727</td>
<td>...</td>
<td>-1.035897</td>
<td>-1.064031</td>
<td>0.003073</td>
<td>-0.815116</td>
<td>0.395236</td>
<td>-0.248275</td>
<td>-0.194908</td>
<td>1.711702</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">762</td>
<td>-0.330519</td>
<td>1.298674</td>
<td>-0.282404</td>
<td>-0.580884</td>
<td>-0.296987</td>
<td>-0.307778</td>
<td>-0.629418</td>
<td>0.804212</td>
<td>-0.074248</td>
<td>-0.522624</td>
<td>...</td>
<td>-0.670609</td>
<td>-0.755570</td>
<td>-0.445795</td>
<td>-0.098325</td>
<td>-0.212117</td>
<td>-0.469370</td>
<td>2.382052</td>
<td>1.716224</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">763</td>
<td>-0.220512</td>
<td>-0.270298</td>
<td>-0.620254</td>
<td>-0.683245</td>
<td>-0.124907</td>
<td>-0.147658</td>
<td>-0.261491</td>
<td>0.963556</td>
<td>0.241490</td>
<td>-0.673362</td>
<td>...</td>
<td>-0.919697</td>
<td>-0.976286</td>
<td>-0.024656</td>
<td>-0.671197</td>
<td>-0.041141</td>
<td>-0.427420</td>
<td>0.019501</td>
<td>1.720746</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">764</td>
<td>-0.176068</td>
<td>1.769646</td>
<td>1.689296</td>
<td>-0.250124</td>
<td>-0.391659</td>
<td>-0.330457</td>
<td>-0.221288</td>
<td>-0.396462</td>
<td>1.218088</td>
<td>0.369610</td>
<td>...</td>
<td>0.396555</td>
<td>0.300107</td>
<td>2.092385</td>
<td>-0.907821</td>
<td>-0.817778</td>
<td>1.038667</td>
<td>-1.485672</td>
<td>1.725269</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">765</td>
<td>-0.607202</td>
<td>1.274797</td>
<td>-0.403914</td>
<td>-0.421960</td>
<td>-0.370531</td>
<td>-0.425389</td>
<td>-0.690925</td>
<td>0.227705</td>
<td>-0.329166</td>
<td>-0.247513</td>
<td>...</td>
<td>0.048693</td>
<td>-0.075066</td>
<td>0.103883</td>
<td>-0.402058</td>
<td>-0.081100</td>
<td>-0.334345</td>
<td>0.015095</td>
<td>1.729791</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>1705 rows × 52 columns</p>
</div>
</div>
</div>
<div id="4f345c36" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>Xtest_1 <span class="op">=</span> sls_test_pd[sls_test_pd[<span class="st">"paciente"</span>] <span class="op">==</span> <span class="dv">1</span>].iloc[:,:<span class="op">-</span><span class="dv">3</span>].copy()</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>ytest_1 <span class="op">=</span> sls_test_pd[sls_test_pd[<span class="st">"paciente"</span>] <span class="op">==</span> <span class="dv">1</span>].loc[:,<span class="st">"y"</span>].copy()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ytest_bin_1 <span class="op">=</span> label_binarize(ytest_1, classes<span class="op">=</span><span class="bu">list</span>(sleep_stages.keys()))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="25318ecf" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>observe_results(predict_model_XGBoost(modelos, Xtest_1.values), ytest_bin_1)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wake AUC: 0.944198
N1 AUC: 0.767631
N2 AUC: 0.868442
N3 AUC: 0.928917
REM AUC: 0.945260</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-68-output-2.png" width="571" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Los resultados son excelentes, los modelos que tenían peor rendimiento en el conjunto de validación, lo han mejorado sustancialmente en el test del primer paciente. Los modelos con mejor resultado anteriormente han mostrado un rendimiento ligeramente peor, pero siguen obteniendo resultados muy competentes.</p>
<p>Mostramos el hipnograma del primer paciente.</p>
<div id="71f50ae3" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>comparar_hipnogramas(ytest_1,procesar_filas(predict_model_XGBoost(modelos, Xtest_1.values)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-69-output-2.png" width="681" height="967" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="53fe0a75" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Xtest_2 <span class="op">=</span> sls_test_pd[sls_test_pd[<span class="st">"paciente"</span>] <span class="op">==</span> <span class="dv">2</span>].iloc[:,:<span class="op">-</span><span class="dv">3</span>].copy()</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>ytest_2 <span class="op">=</span> sls_test_pd[sls_test_pd[<span class="st">"paciente"</span>] <span class="op">==</span> <span class="dv">2</span>].loc[:,<span class="st">"y"</span>].copy()</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>ytest_bin_2 <span class="op">=</span> label_binarize(ytest_2, classes<span class="op">=</span><span class="bu">list</span>(sleep_stages.keys()))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora observamos los resultado para el paciente número 2.</p>
<div id="0630cd4e" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>observe_results(predict_model_XGBoost(modelos, Xtest_2.values), ytest_bin_2)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wake AUC: 0.929504
N1 AUC: 0.809071
N2 AUC: 0.755612
N3 AUC: 0.939725
REM AUC: 0.775676</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-71-output-2.png" width="571" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Obtenemos resultados muy buenos para todos los modelos, a excepción del modelo de la fase <code>N2</code> que ahora obtiene un rendimiento notablemente inferior al mostrado previamente.</p>
<div id="1bdd5343" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>comparar_hipnogramas(ytest_2,procesar_filas(predict_model_XGBoost(modelos, Xtest_2.values)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr
C:\Users\enriq\AppData\Local\miniconda3\envs\ads\Lib\site-packages\yasa\plotting.py:89: FutureWarning: 'S' is deprecated and will be removed in a future version. Please use 's' instead of 'S'.
  freq_str = pd.tseries.frequencies.to_offset(pd.Timedelta(1 / sf_hypno, "S")).freqstr</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-72-output-2.png" width="681" height="967" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparación-con-el-artículo-de-referencia" class="level1">
<h1>7. Comparación con el artículo de referencia</h1>
<p>Por último, realizaremos una comparación con los resultados del artículo original publicado por la Universidad de Coímbra. Analizaremos los resultados de cada una de las métricas incluidas en el artículo para el subgrupo III, que es el que se ha utilizado en este proyecto.</p>
<p>Para ello, primero crearemos un dataframe con todos los datos para que sea más sencillo observar las diferencias.</p>
<div id="31f90833" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer print en la misma columna</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.width'</span>, <span class="dv">1000</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Guardamos todas las métricas en una lista</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>metricas_finales <span class="op">=</span> [metricas_Wake, metricas_N1, metricas_N2, metricas_N3, metricas_REM]</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultados del artículo (sin intervalos de confianza)</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>resultados_articulo <span class="op">=</span> [{<span class="st">"AUC"</span>: <span class="fl">0.9277</span>, <span class="st">"Especificidad"</span>: <span class="fl">0.9303</span>, <span class="st">"Sensibilidad"</span>: <span class="fl">0.9336</span>, <span class="st">"Accuracy"</span>: <span class="fl">0.9343</span>},</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>                       {<span class="st">"AUC"</span>: <span class="fl">0.7235</span>, <span class="st">"Especificidad"</span>: <span class="fl">0.7971</span>, <span class="st">"Sensibilidad"</span>: <span class="fl">0.7341</span>, <span class="st">"Accuracy"</span>: <span class="fl">0.7591</span>},</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>                       {<span class="st">"AUC"</span>: <span class="fl">0.7958</span>, <span class="st">"Especificidad"</span>: <span class="fl">0.8261</span>, <span class="st">"Sensibilidad"</span>: <span class="fl">0.8686</span>, <span class="st">"Accuracy"</span>: <span class="fl">0.8715</span>},</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>                       {<span class="st">"AUC"</span>: <span class="fl">0.9141</span>, <span class="st">"Especificidad"</span>: <span class="fl">0.8337</span>, <span class="st">"Sensibilidad"</span>: <span class="fl">0.9193</span>, <span class="st">"Accuracy"</span>: <span class="fl">0.9438</span>},</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>                       {<span class="st">"AUC"</span>: <span class="fl">0.8650</span>, <span class="st">"Especificidad"</span>: <span class="fl">0.8786</span>, <span class="st">"Sensibilidad"</span>: <span class="fl">0.8919</span>, <span class="st">"Accuracy"</span>: <span class="fl">0.9146</span>}]</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> [<span class="st">"AUC_Nuestro"</span>, <span class="st">"AUC_Articulo"</span>, <span class="st">"Spec_Nuestra"</span>, <span class="st">"Spec_Articulo"</span>, <span class="st">"Sens_Nuestra"</span>, <span class="st">"Sens_Articulo"</span>, <span class="st">"Acc_Nuestro"</span>, <span class="st">"Acc_Articulo"</span>]</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>tabla_metricas <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>columnas, index<span class="op">=</span>clases)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(metricas_finales)):</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    tabla_metricas.iloc[i] <span class="op">=</span> [metricas_finales[i][<span class="st">"AUC"</span>], resultados_articulo[i][<span class="st">"AUC"</span>],</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>                              metricas_finales[i][<span class="st">"Especificidad"</span>], resultados_articulo[i][<span class="st">"Especificidad"</span>],</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>                              metricas_finales[i][<span class="st">"Sensibilidad"</span>], resultados_articulo[i][<span class="st">"Sensibilidad"</span>],</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>                              metricas_finales[i][<span class="st">"Accuracy"</span>], resultados_articulo[i][<span class="st">"Accuracy"</span>]]</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>tabla_metricas</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AUC_Nuestro</th>
<th data-quarto-table-cell-role="th">AUC_Articulo</th>
<th data-quarto-table-cell-role="th">Spec_Nuestra</th>
<th data-quarto-table-cell-role="th">Spec_Articulo</th>
<th data-quarto-table-cell-role="th">Sens_Nuestra</th>
<th data-quarto-table-cell-role="th">Sens_Articulo</th>
<th data-quarto-table-cell-role="th">Acc_Nuestro</th>
<th data-quarto-table-cell-role="th">Acc_Articulo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Wake</td>
<td>0.919564</td>
<td>0.9277</td>
<td>0.994032</td>
<td>0.9303</td>
<td>0.845095</td>
<td>0.9336</td>
<td>0.944698</td>
<td>0.9343</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">N1</td>
<td>0.774752</td>
<td>0.7235</td>
<td>0.834387</td>
<td>0.7971</td>
<td>0.715116</td>
<td>0.7341</td>
<td>0.822691</td>
<td>0.7591</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">N2</td>
<td>0.825164</td>
<td>0.7958</td>
<td>0.793594</td>
<td>0.8261</td>
<td>0.856734</td>
<td>0.8686</td>
<td>0.806157</td>
<td>0.8715</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">N3</td>
<td>0.915777</td>
<td>0.9141</td>
<td>0.930319</td>
<td>0.8337</td>
<td>0.901235</td>
<td>0.9193</td>
<td>0.923603</td>
<td>0.9438</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">REM</td>
<td>0.956566</td>
<td>0.865</td>
<td>0.949569</td>
<td>0.8786</td>
<td>0.963563</td>
<td>0.8919</td>
<td>0.951539</td>
<td>0.9146</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Para mostrar mejor las diferencias, realizamos otro dataframe que muestre las diferencias entre nuestros modelos y los del artículo. Si el resultado es positivo significa que nuestro modelo es mejor en esa métrica, si es negativo, el modelo utilizado en el artículo es mejor.</p>
<div id="ca892186" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>metricas_utilizadas <span class="op">=</span> [<span class="st">"AUC"</span>, <span class="st">"Especificidad"</span>, <span class="st">"Sensibilidad"</span>, <span class="st">"Accuracy"</span>]</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>dif_metricas <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>metricas_utilizadas, index<span class="op">=</span>clases)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(metricas_finales)):</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    dif_metricas.iloc[i] <span class="op">=</span> [metricas_finales[i][<span class="st">"AUC"</span>] <span class="op">-</span> resultados_articulo[i][<span class="st">"AUC"</span>],</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                            metricas_finales[i][<span class="st">"Especificidad"</span>] <span class="op">-</span> resultados_articulo[i][<span class="st">"Especificidad"</span>],</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                            metricas_finales[i][<span class="st">"Sensibilidad"</span>] <span class="op">-</span> resultados_articulo[i][<span class="st">"Sensibilidad"</span>],</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                            metricas_finales[i][<span class="st">"Accuracy"</span>] <span class="op">-</span> resultados_articulo[i][<span class="st">"Accuracy"</span>]]</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>dif_metricas</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AUC</th>
<th data-quarto-table-cell-role="th">Especificidad</th>
<th data-quarto-table-cell-role="th">Sensibilidad</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Wake</td>
<td>-0.008136</td>
<td>0.063732</td>
<td>-0.088505</td>
<td>0.010398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">N1</td>
<td>0.051252</td>
<td>0.037287</td>
<td>-0.018984</td>
<td>0.063591</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">N2</td>
<td>0.029364</td>
<td>-0.032506</td>
<td>-0.011866</td>
<td>-0.065343</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">N3</td>
<td>0.001677</td>
<td>0.096619</td>
<td>-0.018065</td>
<td>-0.020197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">REM</td>
<td>0.091566</td>
<td>0.070969</td>
<td>0.071663</td>
<td>0.036939</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Ahora analizaremos uno a uno los resultados:</p>
<li>
Wake: Obtenemos unos resultados excelentes, solamente tenemos un peor resultado en sensibilidad, pero entra dentro de su intervalo de confianza. En el resto de metricas obtenemos resultados mejores, incluida la especificidad, para la cual obtenemos un resultado mejor que el intervalo de confianza del artículo (de 3.78).
</li>
<li>
N1: Obtenemos un resultado mucho mejor en especificidad y accuracy, pero nuestro AUC es peor (aunque dentro de su intervalo de confianza). Lo verdaderamente llamativo es el resultado en sensibilidad, para el cual en el artículo han conseguido un resultado bastante bueno, que no consiguen con ninguno de los otros subgrupos. Nuestro resultado entraría dentro del intervalo de confianza de los otros subgrupos, pero se aleja mucho del obtenido en el artículo en el subgrupo III.
</li>
<li>
N2: Los resultados obtenidos son muy similares a los del artículo. Nuestro AUC es mejor, pero se encuentra en el intervalo de confianza del artículo, así como nuestro accuracy, que es peor, pero también está dentro del intervalo. Para la especificidad, hemos obtenido un resultado ligeramente por encima del intervalo de confianza, mientras que para la sensibilidad es ligeramente peor.
</li>
<li>
N3: Son los mejores resultados obtenidos en comparación con el artículo. El AUC y la especificidad, pese a estar dentro del intervalo de confianza del artículo, dan resultados mejores, mientras que para la sensibilidad y el accuracy los resultados son prácticamente los mismos.
</li>
<li>
REM: Pese a que el resultado en especificidad se encuentra por encima de su intervalo de confianza y el resultado en accuracy es ligeramente mejor, nuestros resultados en AUC y sensibilidad están por debajo del intervalo. Llama la atención especialmente la sensibilidad, la cual se encuentra bastante por debajo del intervalo del artículo.
</li>
<p>Como conclusión, comparando los resultados con los del artículo de referencia, obtenemos que nuestros modelos ofrecen mejores resultados para la especificidad para todas y cada una de las fases, pero en general los resultados para la sensibilidad son bastante pobres en comparación con el artículo, especialmente para las fases N1 y REM. Por lo tanto, el principal aspecto a mejorar en nuestros modelos es la capacidad para captar estas dos fases cuando el paciente se encuentra en ellas, o lo que es lo mismo, mejorar la sensibilidad obtenida.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Volver arriba</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>